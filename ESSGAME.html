<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESS MANAGER -Story Edition-</title>
    <style>
       * { 
    margin: 0; 
    padding: 0; 
    box-sizing: border-box; 
}

body {
    font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
    position: relative;
    overflow-x: hidden;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 30%, rgba(102, 126, 234, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(118, 75, 162, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
}

#game-container {
    max-width: 900px;
    margin: 20px auto;
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 24px;
    box-shadow: 
        0 30px 90px rgba(0,0,0,0.6),
        0 0 0 1px rgba(255, 255, 255,0.1) inset,
        0 0 40px rgba(102, 126, 234, 0.3);
    min-height: 92vh;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
    border: 3px solid rgba(102, 126, 234, 0.2);
    animation: containerFloat 6s ease-in-out infinite;
}

@keyframes containerFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
}

header {
    background: linear-gradient(135deg, #667eea 0%, #3faf69 50%, #92fcec 100%);
    color: white;
    padding: 24px;
    border-radius: 24px 24px 0 0;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
}

header::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.1) 50%,
        transparent 70%
    );
    animation: headerShine 3s ease-in-out infinite;
}

@keyframes headerShine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

header h2 {
    position: relative;
    z-index: 1;
    font-size: 1.8em;
    text-shadow: 
        0 2px 10px rgba(0, 0, 0,0.3),
        0 0 20px rgba(255, 255, 255,0.5);
    letter-spacing: 2px;
}

#status-bar {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
    padding: 20px;
    background: linear-gradient(180deg, #e8eaf6 0%, #f5f5f5 100%);
    border-bottom: 2px solid rgba(102, 126, 234, 0.2);
}

.stat-box {
    background: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
    padding: 14px;
    border-radius: 14px;
    text-align: center;
    box-shadow: 
        0 4px 12px rgba(0,0,0,0.08),
        0 0 0 1px rgba(102, 126, 234, 0.1) inset;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
    transition: left 0.5s;
}

.stat-box:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
        0 8px 20px rgba(0, 0, 0,0.12),
        0 0 0 2px rgba(102, 126, 234, 0.3) inset;
}

.stat-box:hover::before {
    left: 100%;
}

.stat-label { 
    font-size: 0.75em; 
    color: #666; 
    font-weight: bold; 
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 4px;
}

.stat-value { 
    font-size: 1.4em; 
    font-weight: bold; 
    background: linear-gradient(135deg, #667eea 0%, #4a8da4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

#main-display {
    flex-grow: 1;
    padding: 24px;
    overflow-y: auto;
    background: linear-gradient(180deg, #fafafa 0%, #ffffff 100%);
}

.story-box {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
    border: 3px solid #47a775;
    border-radius: 18px;
    padding: 20px;
    margin-bottom: 24px;
    position: relative;
    box-shadow: 
        0 8px 24px rgba(77, 162, 162, 0.2),
        0 0 0 1px rgba(255, 255, 255,0.5) inset;
    animation: storyPulse 2s ease-in-out infinite;
}

@keyframes storyPulse {
    0%, 100% { box-shadow: 0 8px 24px rgba(62, 176, 85, 0.2), 0 0 0 1px rgba(255, 255, 255,0.5) inset; }
    50% { box-shadow: 0 8px 32px rgba(74, 164, 88, 0.35), 0 0 20px rgba(64, 174, 91, 0.2) inset; }
}

.story-box::before {
    position: absolute;
    top: -15px;
    left: 20px;
    font-size: 2em;
    background: white;
    padding: 0 8px;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0, 0, 0,0.1);
}

.char-name { 
    font-weight: bold; 
    color: #557199; 
    margin-bottom: 8px;
    font-size: 1.1em;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

#story-text {
    font-size: 1.05em;
    line-height: 1.8;
    color: #2c3e50;
}

.member-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 16px;
    margin-top: 20px;
}

.member-card {
    border: 3px solid #e0e0e0;
    border-radius: 16px;
    padding: 16px;
    background: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0, 0, 0,0.08);
}

.member-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #667eea 0%, #34ba63 100%);
    transform: scaleX(0);
    transition: transform 0.3s ease;
}

.member-card:hover {
    border-color: #54709a;
    transform: translateY(-5px) scale(1.02);
    box-shadow: 
        0 12px 28px rgba(67, 171, 103, 0.3),
        0 0 20px rgba(79, 159, 97, 0.1);
}

.member-card:hover::before {
    transform: scaleX(1);
}

.member-card.selected {
    border: 3px solid #3791b7;
    background: linear-gradient(145deg, #e6f1f4 0%, #bad1eb 100%);
    box-shadow: 
        0 8px 24px rgba(69, 169, 162, 0.4),
        0 0 30px rgba(56, 182, 163, 0.2) inset;
    animation: selectedPulse 1.5s ease-in-out infinite;
}

@keyframes selectedPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

.member-card.graduating {
    border: 3px solid #ff9800;
    background: linear-gradient(145deg, #fff3e0 0%, #ffe0b2 100%);
    box-shadow: 0 4px 16px rgba(255, 152, 0, 0.3);
}

.member-card.graduating::after {
    content: 'üéì';
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 1.5em;
    animation: graduateFloat 2s ease-in-out infinite;
}

@keyframes graduateFloat {
    0%, 100% { transform: translateY(0px) rotate(0deg); }
    50% { transform: translateY(-5px) rotate(10deg); }
}

.member-card.burnout {
    border: 3px solid #f44336;
    background: linear-gradient(145deg, #ffebee 0%, #ffcdd2 100%);
    box-shadow: 0 4px 16px rgba(244, 67, 54, 0.3);
    animation: burnoutShake 0.5s ease-in-out infinite;
}

@keyframes burnoutShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-2px); }
    75% { transform: translateX(2px); }
}

.progress-bar { 
    height: 10px; 
    background: linear-gradient(90deg, #e0e0e0 0%, #f5f5f5 100%); 
    border-radius: 10px; 
    margin: 8px 0; 
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1) inset;
    position: relative;
}

.progress-bar::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255,0.3), transparent);
    animation: progressShine 2s ease-in-out infinite;
}

@keyframes progressShine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.progress-fill { 
    height: 100%; 
    background: linear-gradient(90deg, #667eea 0%, #49a56b 100%); 
    transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 20px;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255,0.4));
    border-radius: 0 10px 10px 0;
}

.recruit-card {
    border: 3px solid #90caf9;
    border-radius: 16px;
    padding: 16px;
    background: linear-gradient(145deg, #ffffff 0%, #e3f2fd 100%);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(2, 136, 209, 0.2);
}

.recruit-card::before {
    content: '‚ú®';
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 1.5em;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.recruit-card:hover {
    border-color: #0288d1;
    transform: scale(1.05) rotate(1deg);
    box-shadow: 0 12px 32px rgba(2, 136, 209, 0.4);
}

.recruit-card:hover::before {
    opacity: 1;
    animation: sparkle 1s ease-in-out infinite;
}

@keyframes sparkle {
    0%, 100% { transform: scale(1) rotate(0deg); }
    50% { transform: scale(1.2) rotate(180deg); }
}

.recruit-card.selected {
    border: 3px solid #0288d1;
    background: linear-gradient(145deg, #e1f5fe 0%, #b3e5fc 100%);
    box-shadow: 
        0 8px 24px rgba(2, 136, 209, 0.5),
        0 0 30px rgba(2, 136, 209, 0.2) inset;
    transform: scale(1.03);
}

#action-panel {
    padding: 24px;
    background: linear-gradient(180deg, #f5f5f5 0%, #e8eaf6 100%);
    border-top: 2px solid rgba(102, 126, 234, 0.2);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    box-shadow: 0 -4px 20px rgba(0, 0, 0,0.05);
}

button {
    padding: 14px 20px;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 1em;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: rgba(255, 255, 255,0.5);
    transform: translate(-50%, -50%);
    transition: width 0.6s, height 0.6s;
}

button:hover::before {
    width: 300px;
    height: 300px;
}

.btn-action { 
    background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%); 
    color: #0277bd; 
    border: 2px solid #0288d1;
}

.btn-action:hover:not(:disabled) {
    background: linear-gradient(135deg, #b3e5fc 0%, #81d4fa 100%);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(2, 136, 209, 0.4);
}

.btn-choice { 
    background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%); 
    color: #ad1457; 
    border: 2px solid #c2185b;
}

.btn-choice:hover:not(:disabled) {
    background: linear-gradient(135deg, #f8bbd0 0%, #f48fb1 100%);
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(194, 24, 91, 0.4);
}

.btn-next { 
    grid-column: span 2; 
    background: linear-gradient(135deg, #4b71e0 0%, #4a79a4 100%); 
    color: white; 
    margin-top: 10px;
    border: 2px solid rgba(255,255,255,0.3);
    font-size: 1.1em;
    letter-spacing: 1px;
    text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.btn-next:hover:not(:disabled) {
    background: linear-gradient(135deg, #269aae 0%, #b9eaec 100%);
    transform: translateY(-4px) scale(1.02);
    box-shadow: 0 12px 32px rgba(62, 176, 85, 0.5);
}

button:disabled { 
    background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%); 
    cursor: not-allowed; 
    border: 2px solid #9e9e9e;
    color: #757575;
    opacity: 0.6;
    transform: none !important;
}

.hidden { 
    display: none !important; 
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    animation: modalFadeIn 0.3s ease;
    backdrop-filter: blur(8px);
}

@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}






.modal-content {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    padding: 36px;
    border-radius: 24px;
    max-width: 700px;
    max-height: 85vh;    
    width: 90%;  /* ‚ÜêËøΩÂä†: „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
    margin: 0 auto;  /* ‚ÜêËøΩÂä†: ‰∏≠Â§ÆÊèÉ„Åà */
    overflow-y: auto;
    box-shadow: 
        0 30px 90px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.5) inset;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 3px solid rgba(102, 126, 234, 0.3);
}

@keyframes modalSlideIn {
    from { 
        transform: translateY(-50px) scale(0.9); 
        opacity: 0;
    }
    to { 
        transform: translateY(0) scale(1); 
        opacity: 1;
    }
}

.modal-content h2 {
    background: linear-gradient(135deg, #667eea 0%, #556499 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-size: 2em;
}

.result-box {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 50%, #ffd700 100%);
    padding: 28px;
    border-radius: 20px;
    margin: 24px 0;
    text-align: center;
    font-size: 1.6em;
    font-weight: bold;
    color: #333;
    box-shadow: 
        0 8px 24px rgba(255, 215, 0, 0.4),
        0 0 40px rgba(255, 215, 0, 0.3) inset;
    animation: resultShine 2s ease-in-out infinite;
    border: 3px solid #ffb300;
}

@keyframes resultShine {
    0%, 100% { 
        box-shadow: 0 8px 24px rgba(255, 215, 0, 0.4), 0 0 40px rgba(255, 215, 0, 0.3) inset; 
    }
    50% { 
        box-shadow: 0 12px 36px rgba(255, 215, 0, 0.6), 0 0 60px rgba(255, 215, 0, 0.5) inset; 
    }
}

.trait-tag {
    display: inline-block;
    padding: 4px 10px;
    margin: 3px;
    border-radius: 16px;
    font-size: 0.8em;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    transition: all 0.3s ease;
}

.trait-tag:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0,0.25);
}

.trait-active { background: linear-gradient(135deg, #c8e6c9 0%, #a5d6a7 100%); color: #1b5e20; border: 2px solid #43a047; }
.trait-passive { background: linear-gradient(135deg, #ffccbc 0%, #ffab91 100%); color: #bf360c; border: 2px solid #e64a19; }
.trait-leader { background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%); color: #f57f17; border: 2px solid #fbc02d; }
.trait-steady { background: linear-gradient(135deg, #bbdefb 0%, #90caf9 100%); color: #0d47a1; border: 2px solid #1976d2; }
.trait-cheerful { background: linear-gradient(135deg, #f8bbd0 0%, #f48fb1 100%); color: #880e4f; border: 2px solid #c2185b; }
.trait-cautious { background: linear-gradient(135deg, #d1c4e9 0%, #b39ddb 100%); color: #311b92; border: 2px solid #512da8; }
.trait-lazy { background: linear-gradient(135deg, #e0e0e0 0%, #bdbdbd 100%); color: #212121; border: 2px solid #616161; }
.trait-excellent { background: linear-gradient(135deg, #b2dfdb 0%, #80cbc4 100%); color: #004d40; border: 2px solid #00695c; }

.burnout-warning {
    background: linear-gradient(145deg, #ffebee 0%, #ffcdd2 100%);
    border: 3px solid #f44336;
    padding: 16px;
    border-radius: 14px;
    margin: 16px 0;
    color: #b71c1c;
    font-weight: bold;
    box-shadow: 
        0 6px 20px rgba(244, 67, 54, 0.3),
        0 0 20px rgba(244, 67, 54, 0.1) inset;
    animation: warningPulse 1.5s ease-in-out infinite;
}

@keyframes warningPulse {
    0%, 100% { 
        transform: scale(1); 
        box-shadow: 0 6px 20px rgba(244, 67, 54, 0.3), 0 0 20px rgba(244, 67, 54, 0.1) inset; 
    }
    50% { 
        transform: scale(1.02); 
        box-shadow: 0 8px 28px rgba(244, 67, 54, 0.5), 0 0 30px rgba(244, 67, 54, 0.2) inset; 
    }
}

/* „Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÅÆ„Ç´„Çπ„Çø„Éû„Ç§„Ç∫ */
::-webkit-scrollbar {
    width: 10px;
}

::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, #667eea 0%, #55a24d 100%);
    border-radius: 10px;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(135deg, #4ea06a 0%, #a4ccea 100%);
}

/* „Çø„Ç§„Éà„É´ÁîªÈù¢Â∞ÇÁî®„Çπ„Çø„Ç§„É´ */
#title-screen {
    background: linear-gradient(135deg, #e1e6fb 0%, #e1f9f3 50%, #f8fefb 100%);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    color: black;
    animation: titleGradient 5s ease infinite;
    background-size: 200% 200%;
}

@keyframes titleGradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
}

#title-screen h1 {
    font-size: 3.5em;
    text-shadow: 
        0 4px 20px rgba(0, 0, 0,0.4),
        0 0 40px rgba(255,255,255,0.5);
    animation: titleFloat 3s ease-in-out infinite;
    margin-bottom: 20px;
}

@keyframes titleFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
}

#title-screen p {
    font-size: 1.3em;
    text-shadow: 0 2px 10px rgba(0, 0, 0,0.3);
    margin: 30px 0;
    animation: titleFade 2s ease-in-out infinite;
}

@keyframes titleFade {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}


/* ÂÆüÁ∏æ„Éú„Çø„É≥ */
.achievement-button {
    position: absolute;
    top: 90px;
    left: 20px;
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    color: #333;
    border: 3px solid #ffb300;
    border-radius: 12px;
    padding: 10px 16px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
    transition: all 0.3s ease;
    z-index: 10;
}

.achievement-button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6);
}

.achievement-badge {
    background: rgba(255, 255, 255, 0.3);
    padding: 2px 8px;
    border-radius: 10px;
    font-size: 0.85em;
    margin-left: 5px;
}

/* ÂÆüÁ∏æ„É¢„Éº„ÉÄ„É´ */
.achievement-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 16px;
    margin-top: 20px;
}

.achievement-card {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    border: 3px solid #e0e0e0;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.achievement-card.unlocked {
    border-color: #ffd700;
    background: linear-gradient(145deg, #fffbea 0%, #fff9c4 100%);
    box-shadow: 0 8px 24px rgba(255, 215, 0, 0.3);
}

.achievement-card.locked {
    opacity: 0.5;
    filter: grayscale(0.8);
}

.achievement-icon {
    font-size: 3em;
    margin-bottom: 10px;
    display: block;
}

.achievement-card.unlocked .achievement-icon {
    animation: iconPop 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes iconPop {
    0% { transform: scale(0); }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.achievement-name {
    font-weight: bold;
    font-size: 1.1em;
    color: #333;
    margin: 10px 0 5px;
}

.achievement-desc {
    font-size: 0.9em;
    color: #666;
    line-height: 1.4;
}

.achievement-date {
    font-size: 0.75em;
    color: #999;
    margin-top: 8px;
    font-style: italic;
}

/* ÂÆüÁ∏æËß£Èô§ÈÄöÁü• */
.achievement-notification {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    border: 3px solid #ffb300;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(255, 215, 0, 0.5);
    z-index: 3000;
    animation: notificationSlideIn 0.5s ease, notificationShine 2s ease-in-out infinite;
    min-width: 300px;
}

@keyframes notificationSlideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes notificationShine {
    0%, 100% {
        box-shadow: 0 8px 32px rgba(255, 215, 0, 0.5);
    }
    50% {
        box-shadow: 0 12px 48px rgba(255, 215, 0, 0.8);
    }
}

.notification-content {
    display: flex;
    align-items: center;
    gap: 15px;
}

.notification-icon {
    font-size: 2.5em;
    animation: iconRotate 1s ease-in-out infinite;
}

@keyframes iconRotate {
    0%, 100% { transform: rotate(0deg) scale(1); }
    25% { transform: rotate(-10deg) scale(1.1); }
    75% { transform: rotate(10deg) scale(1.1); }
}

.notification-text {
    flex: 1;
}

.notification-title {
    font-weight: bold;
    font-size: 1.2em;
    color: #333;
    margin-bottom: 5px;
}

.notification-desc {
    font-size: 0.95em;
    color: #555;
}

/* „Ç§„Éô„É≥„Éà„Ç´„Éº„Éâ */
.event-card-modal {
    background: rgba(0, 0, 0, 0.9);
    backdrop-filter: blur(10px);
}

.event-card {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9ff 100%);
    border: 4px solid;
    border-radius: 20px;
    padding: 30px;
    max-width: 500px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    animation: cardFlip 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

@keyframes cardFlip {
    0% {
        transform: perspective(1000px) rotateY(90deg) scale(0.8);
        opacity: 0;
    }
    100% {
        transform: perspective(1000px) rotateY(0deg) scale(1);
        opacity: 1;
    }
}

.event-card.positive {
    border-color: #4caf50;
    background: linear-gradient(145deg, #e8f5e9 0%, #c8e6c9 100%);
}

.event-card.negative {
    border-color: #f44336;
    background: linear-gradient(145deg, #ffebee 0%, #ffcdd2 100%);
}

.event-card.neutral {
    border-color: #2196f3;
    background: linear-gradient(145deg, #e3f2fd 0%, #bbdefb 100%);
}

.event-card::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 70%
    );
    animation: cardShine 3s ease-in-out infinite;
}

@keyframes cardShine {
    0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
    100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
}

.event-icon {
    font-size: 4em;
    text-align: center;
    margin-bottom: 20px;
    animation: eventIconBounce 1s ease-in-out infinite;
    position: relative;
    z-index: 1;
}

@keyframes eventIconBounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.event-title {
    font-size: 1.8em;
    font-weight: bold;
    text-align: center;
    margin-bottom: 15px;
    color: #333;
    position: relative;
    z-index: 1;
}

.event-description {
    font-size: 1.1em;
    line-height: 1.6;
    color: #555;
    margin-bottom: 20px;
    text-align: center;
    position: relative;
    z-index: 1;
}

.event-effects {
    background: rgba(255, 255, 255, 0.5);
    border-radius: 12px;
    padding: 15px;
    margin: 20px 0;
    position: relative;
    z-index: 1;
}

.event-effect-item {
    padding: 8px 0;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.event-effect-positive {
    color: #2e7d32;
}

.event-effect-negative {
    color: #c62828;
}

/* „Çª„Éº„Éñ/„É≠„Éº„Éâ„Éë„Éç„É´ */
#save-load-panel {
    background: linear-gradient(180deg, #f5f5f5 0%, #e8eaf6 100%);
    border-radius: 12px;
    padding: 15px;
    margin: 10px 0;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

/* „Çπ„Éû„ÉõÂØæÂøú */
@media (max-width: 768px) {
    #save-load-panel {
        grid-template-columns: 1fr;
    }
}

/* ÂÆüÁ∏æ„Éú„Çø„É≥„ÅÆ„Çπ„Çø„Ç§„É´Ë™øÊï¥Ôºà„Éë„Éç„É´ÂÜÖ„Å´ÈÖçÁΩÆ„Åô„Çã„Åü„ÇÅÔºâ */
.achievement-button {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    color: #333;
    border: 3px solid #ffb300;
    border-radius: 12px;
    padding: 14px 20px;
    font-weight: bold;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.4);
    transition: all 0.3s ease;
    font-size: 1em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.achievement-button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 20px rgba(255, 215, 0, 0.6);
}


.save-slot {
    background: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    padding: 15px;
    margin: 10px 0;
    cursor: pointer;
    transition: all 0.3s ease;
}

.save-slot:hover {
    border-color: #667eea;
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.save-slot.empty {
    opacity: 0.6;
    font-style: italic;
    color: #999;
}

.save-slot-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
}

.save-slot-title {
    font-weight: bold;
    font-size: 1.1em;
    color: #333;
}

.save-slot-date {
    font-size: 0.85em;
    color: #666;
}

.save-slot-info {
    font-size: 0.9em;
    color: #555;
    display: flex;
    gap: 15px;
}

/* „Éë„É´„ÇπÂäπÊûúÔºàÊñ∞Ë¶èÂÆüÁ∏æËß£Èô§ÊôÇÔºâ */
@keyframes pulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
}
/* „Ç∑„Éß„ÉÉ„Éó„É¢„Éº„ÉÄ„É´Â∞ÇÁî®„Çπ„Çø„Ç§„É´ */
.shop-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    animation: modalFadeIn 0.3s ease;
    backdrop-filter: blur(8px);
}

.shop-modal-content {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    padding: 30px;
    border-radius: 24px;
    max-width: 800px;
    max-height: 85vh;
    width: 90%;
    overflow-y: auto;
    box-shadow: 
        0 30px 90px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.5) inset;
    animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 3px solid rgba(102, 126, 234, 0.3);
}

.shop-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid rgba(102, 126, 234, 0.2);
}

.shop-modal-title {
    font-size: 2em;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.shop-budget-display {
    font-size: 1.3em;
    font-weight: bold;
    color: #667eea;
    padding: 10px 20px;
    background: rgba(102, 126, 234, 0.1);
    border-radius: 12px;
}

/* „Ç∑„Éß„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†„Ç∞„É™„ÉÉ„Éâ */
.shop-items-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 16px;
    margin: 20px 0;
}

/* „Ç∑„Éß„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†„Ç´„Éº„Éâ */
.shop-item {
    background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
    border: 3px solid #e0e0e0;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
}

.shop-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
    transition: left 0.5s;
}

.shop-item:hover::before {
    left: 100%;
}

.shop-item:hover {
    border-color: #667eea;
    transform: translateY(-5px) scale(1.02);
    box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
}

.shop-item.affordable {
    border-color: #4caf50;
}

.shop-item.affordable:hover {
    border-color: #2e7d32;
    box-shadow: 0 8px 24px rgba(76, 175, 80, 0.4);
}

.shop-item.expensive {
    opacity: 0.5;
    cursor: not-allowed;
    filter: grayscale(0.5);
}

.shop-item.expensive:hover {
    transform: none;
    border-color: #e0e0e0;
}

.shop-item-icon {
    font-size: 3em;
    margin-bottom: 12px;
    display: block;
    animation: itemFloat 3s ease-in-out infinite;
}

@keyframes itemFloat {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-8px); }
}

.shop-item-name {
    font-weight: bold;
    font-size: 1.15em;
    color: #333;
    margin: 10px 0 8px;
}

.shop-item-desc {
    font-size: 0.9em;
    color: #666;
    margin: 8px 0;
    line-height: 1.5;
    min-height: 40px;
}

.shop-item-price {
    font-size: 1.3em;
    font-weight: bold;
    color: #fff;
    margin-top: 12px;
    padding: 8px 16px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.shop-item.affordable .shop-item-price {
    background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
}

.shop-item.expensive .shop-item-price {
    background: linear-gradient(135deg, #9e9e9e 0%, #757575 100%);
}

/* Ë≥ºÂÖ•Á¢∫Ë™ç„Ç®„Éï„Çß„ÇØ„Éà */
@keyframes purchaseConfirm {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.shop-item.purchasing {
    animation: purchaseConfirm 0.5s ease;
}

/* „Ç§„É≥„Éô„É≥„Éà„É™ÔºàÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É†Ôºâ */
.inventory-item {
    background: linear-gradient(145deg, #fff 0%, #f0f0f0 100%);
    border: 2px solid #bbb;
    border-radius: 12px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.inventory-item:hover {
    border-color: #667eea;
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
}

.inventory-item-icon {
    font-size: 2em;
}

.inventory-item-info {
    flex: 1;
}

.inventory-item-name {
    font-weight: bold;
    font-size: 1em;
    color: #333;
    margin-bottom: 2px;
}

.inventory-item-desc {
    font-size: 0.8em;
    color: #777;
}

.inventory-item-count {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
    color: white;
    border-radius: 50%;
    width: 26px;
    height: 26px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9em;
    font-weight: bold;
    box-shadow: 0 2px 8px rgba(244, 67, 54, 0.4);
    border: 2px solid white;
}

/* „Ç¢„Ç§„ÉÜ„É†‰ΩøÁî®„É¢„Éº„ÉÄ„É´Áî® */
.use-item-modal .member-select-card {
    background: linear-gradient(145deg, #ffffff 0%, #fafafa 100%);
    border: 3px solid #e0e0e0;
    border-radius: 14px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 10px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

.use-item-modal .member-select-card:hover {
    border-color: #667eea;
    transform: translateX(5px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.use-item-modal .member-select-card.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.use-item-modal .member-select-card.disabled:hover {
    transform: none;
    border-color: #e0e0e0;
}

/* „Ç∑„Éß„ÉÉ„Éó„Éú„Çø„É≥„ÅÆ„Éê„ÉÉ„Ç∏ */
.shop-button-badge {
    position: absolute;
    top: -8px;
    right: -8px;
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.75em;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(238, 90, 36, 0.4);
    animation: badgePulse 2s infinite;
}

@keyframes badgePulse {
    0%, 100% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.2);
    }
}

/* „Çπ„Éû„ÉõÂØæÂøú */
@media (max-width: 768px) {
    .shop-items-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 12px;
    }
    
    .shop-item {
        padding: 15px;
    }
    
    .shop-item-icon {
        font-size: 2.5em;
    }
}
    </style>
</head>
<body>

<div id="game-container">
    <div id="title-screen" style="padding: 60px; text-align: center;">
        <h1 style="font-size: 3em; color: #529c7c;">ESS MANAGER</h1>
        <p style="margin: 20px 0;">ÔΩûÊîªÁï•ÊñπÊ≥ï„ÅØ<a href="exp.html"> „Åì„Å°„Çâ</a>ÔΩû</p>
        <button onclick="initGame()" class="btn-next" style="padding: 20px;">Áâ©Ë™û„ÇíÂßã„ÇÅ„Çã</button>
    </div>



<div id="game-main" class="hidden">
    <!-- „Çª„Éº„Éñ/„É≠„Éº„Éâ/ÂÆüÁ∏æ„Éú„Çø„É≥„Éë„Éç„É´ -->
<div id="save-load-panel">
    <button onclick="saveGame()" class="btn-action" style="flex: 1;">üíæ „Çª„Éº„Éñ</button>
    <button onclick="loadGame()" class="btn-action" style="flex: 1;">üìÇ „É≠„Éº„Éâ</button>
    <button onclick="showShopModal()" class="btn-action" style="flex: 1;">üõçÔ∏è „Ç∑„Éß„ÉÉ„Éó</button>
    <button onclick="showAchievementModal()" class="achievement-button">
        üèÜ ÂÆüÁ∏æ <span id="achievement-count" class="achievement-badge">0/12</span>
    </button>
</div>


<!-- „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà„Ç´„Éº„ÉâË°®Á§∫Áî®Ôºà„É¢„Éº„ÉÄ„É´„Å®„Åó„Å¶Ë°®Á§∫Ôºâ -->
<div id="event-card-container"></div>

<!-- ÂÆüÁ∏æËß£Èô§ÈÄöÁü•Áî® -->
<div id="achievement-notification" class="achievement-notification hidden">
    <div class="notification-content">
        <div class="notification-icon">üèÜ</div>
        <div class="notification-text">
            <div class="notification-title">ÂÆüÁ∏æËß£Èô§ÔºÅ</div>
            <div class="notification-desc"></div>
        </div>
    </div>
</div>
    
    
    
        <header>
            <h2 id="display-week">Á¨¨ 1 ÈÄ±</h2>
        </header>

        <div id="status-bar">
            <div class="stat-box"><div class="stat-label">Âπ¥Â∫¶</div><div class="stat-value" id="stat-year">1Âπ¥ÁõÆ</div></div>
            <div class="stat-box"><div class="stat-label">ÈÉ®Ë≤ª</div><div class="stat-value" id="stat-budget">¬•0</div></div>
            <div class="stat-box"><div class="stat-label">ÈÉ®Âì°</div><div class="stat-value" id="stat-members">0</div></div>
            <div class="stat-box"><div class="stat-label">Ëã±Ë™ûÂäõ</div><div class="stat-value" id="stat-eng">0</div></div>
            <div class="stat-box"><div class="stat-label">‰ø°È†º</div><div class="stat-value" id="stat-trust">0</div></div>
        </div>

        <div id="main-display">
            <div class="story-box">
                <div id="char-name" class="char-name">Ê©ò</div>
                <div id="story-text"></div>
            </div>
            <div id="member-list" class="member-grid"></div>
        </div>


<div id="inventory-panel" style="padding: 15px; background: #f9f9f9; border-radius: 12px; margin: 10px 0;">
    <h4 style="margin-bottom: 10px;">üì¶ ÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É† <span id="inventory-count" style="color: #667eea; font-size: 0.9em;">(0ÂÄã)</span></h4>
    <div id="inventory-list" style="display: flex; flex-wrap: wrap; gap: 10px;">
        <div style="color: #999; font-style: italic;">„Ç¢„Ç§„ÉÜ„É†„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì</div>
    </div>
</div>


        <div id="action-panel"></div>
    </div>
</div>

<script>
    const state = {
        week: 1,
        maxWeek: 10,
        year: 1,
        budget: 2000,
        trust: 40,
        members: [
            { name: "Â±±Áî∞", eng: 29, stress: 0, trait: "Á©çÊ•µÁöÑ", year: 3, growthRate: 1.2, burnout: false },
            { name: "Ê©ò", eng: 55, stress: 0, trait: "„É™„Éº„ÉÄ„Éº", year: 5, growthRate: 0.5, burnout: false }
        ],
        hasActed: false,
        contestWeek: 6,
        contestDone: false
    };

    // ÁâπÊÄß„Éá„Éº„Çø„Éô„Éº„Çπ
    const traitData = {
        "Á©çÊ•µÁöÑ": { growthRate: 0.75, stressRate: 1.0, cssClass: "trait-active", desc: "ÊàêÈï∑‚Üë" },
        "Ê∂àÊ•µÁöÑ": { growthRate: 0.4, stressRate: 0.8, cssClass: "trait-passive", desc: "ÊàêÈï∑‚Üì" },
        "„É™„Éº„ÉÄ„Éº": { growthRate: 0.55, stressRate: 0.7, cssClass: "trait-leader", desc: "‰ø°È†º‚Üë" },
        "ÁúüÈù¢ÁõÆ": { growthRate: 0.5, stressRate: 1.2, cssClass: "trait-steady", desc: "Ê®ôÊ∫ñ" },
        "ÂÖÉÊ∞ó": { growthRate: 0.6, stressRate: 0.6, cssClass: "trait-cheerful", desc: "Áñ≤„Çå„Å´„Åè„ÅÑ" },
        "ÊÖéÈáç": { growthRate: 0.5, stressRate: 0.9, cssClass: "trait-cautious", desc: "ÂÆâÂÆö" },
        "„ÅÆ„Çì„Å≥„Çä": { growthRate: 0.43, stressRate: 0.5, cssClass: "trait-lazy", desc: "ÊàêÈï∑ÈÅÖ„ÅÑ" },
        "ÂÑ™ÁßÄ": { growthRate: 0.8, stressRate: 1.3, cssClass: "trait-excellent", desc: "ÊàêÈï∑‚óéÁñ≤„Çå„ÇÑ„Åô„ÅÑ" }
    };

    const recruitPool = [
        { name: "Â∑ùÁî∞", eng: 14, trait: "Á©çÊ•µÁöÑ", year: 3 },
        { name: "Ë•øÂ∑ù", eng: 22, trait: "Á©çÊ•µÁöÑ", year: 1 },
        { name: "ÊúùÂÄâ", eng: 16, trait: "ÂÖÉÊ∞ó", year: 1 },
        { name: "ÂêâÁî∞", eng: 27, trait: "„É™„Éº„ÉÄ„Éº", year: 2 },
        { name: "Â§ßÂâç", eng: 18, trait: "Ê∂àÊ•µÁöÑ", year: 2 },
        { name: "Ê©ãÊú¨", eng: 26, trait: "Ê∂àÊ•µÁöÑ", year: 2 },
        { name: "‰ΩêËó§", eng: 22, trait: "ÁúüÈù¢ÁõÆ", year: 2 },
        { name: "Á•ûË∞∑", eng: 32, trait: "ÂÑ™ÁßÄ", year: 2 },
        { name: "Êûó", eng: 22, trait: "ÂÖÉÊ∞ó", year: 1 },
        { name: "Ëó§Âéü", eng: 26, trait: "„É™„Éº„ÉÄ„Éº", year: 1 },
        { name: "Êó©Â∑ù", eng: 38, trait: "„ÅÆ„Çì„Å≥„Çä", year: 3 },
        { name: "‰∏ãÊµ¶", eng: 24, trait: "ÁúüÈù¢ÁõÆ", year: 1 },
        { name: "È´òÂéü", eng: 29, trait: "Á©çÊ•µÁöÑ", year: 1 },
        { name: "ÂéüÁî∞", eng: 24, trait: "ÂÖÉÊ∞ó", year: 1 },
        { name: "ÂåóÂ±±", eng: 25, trait: "ÁúüÈù¢ÁõÆ", year: 1 },
        { name: "ËøëËó§", eng: 20, trait: "Ê∂àÊ•µÁöÑ", year: 1 },
        { name: "ÂùÇÂè£", eng: 22, trait: "ÁúüÈù¢ÁõÆ", year: 1 }
    ];

    const scenarios = {
        1: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "ÈÉ®Âì°„ÅåÁßÅ„Å®„ÅÇ„Å™„Åü„Å†„Åë„Åò„ÇÉÂªÉÈÉ®„Å´„Å™„Å£„Å¶„Åó„Åæ„ÅÜ„ÄÇ„Åæ„Åö„ÅØ‰ª≤Èñì„ÇíÂ¢ó„ÇÑ„Åù„ÅÜÔºÅÁßÅ„ÇÇ„Åæ„Å†Âú®Â≠¶‰∏≠„Å†„Åã„ÇâÊâã‰ºù„ÅÜ„Çà„ÄÇ",
            action: "scout_required"
        },
        2: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "Êñ∞ÂÖ•ÈÉ®Âì°„ÄÅÁ¢∫‰øù„Åß„ÅôÔºÅ‚Ä¶„Åß„ÇÇ„ÄÅ„Åì„ÅÆÂ≠ê„Åü„Å°„ÄéHello„Äè„ÅÆÁô∫Èü≥„Åå„Äå„Éè„É≠„ÉºÔºàÊ£íË™≠„ÅøÔºâ„Äç„Åß„Åô„Çà„ÄÇ‰ªäÈÄ±„ÅØÂú∞ÁçÑ„ÅÆÁâπË®ì„ÄÅ„ÅÑ„ÅÑ„Åß„Åô„Çà„Å≠Ôºü",
            action: "free"
        },
        3: {
            char: "Âπ≥ÈáéÂÖàÁîü",
            text: "„Åµ„Çì„ÄÇÊñ∞‰∫∫„ÅåÂÖ•„Å£„Åü„Åù„ÅÜ„Å†„Å™„ÄÇ„Å†„ÅåÁîò„ÇÑ„Åã„Åô„Å§„ÇÇ„Çä„ÅØ„Å™„ÅÑ„ÄÇ„Åó„Å£„Åã„ÇäÈçõ„Åà„Çç„ÄÇ",
            action: "free"
        },
        4: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "„Çà„ÅÜ„ÇÑ„Åè„ÄéÈÉ®Ê¥ª„Åó„Å¶„Çã„Å£„ÅΩ„ÅÑ„ÄèÈõ∞Âõ≤Ê∞ó„Å´„Å™„Å£„Å¶„Åç„Åæ„Åó„Åü„Å≠ÔºÅ„Åì„ÅÆË™øÂ≠ê„Åß„ÄÅÂ≠¶Ê†°‰∏≠„ÅÆÁîüÂæí„Å´ÁßÅ„Åü„Å°„ÅÆÊµÅÊö¢„Å™R„Å®L„ÅÆ‰Ωø„ÅÑÂàÜ„Åë„ÇíË¶ã„Åõ„Å§„Åë„Å°„ÇÉ„ÅÑ„Åæ„Åó„Çá„ÅÜÔºÅ",
            action: "free"
        },
        5: {
            char: "Âπ≥ÈáéÂÖàÁîü",
            text: "Êù•ÈÄ±„ÄÅÂú∞Âå∫„Ç≥„É≥„ÉÜ„Çπ„Éà„Åå„ÅÇ„Çã„Çì„Å†„ÄÇ2Âêç„ÇíÈÅ∏Êäú„Åó„Å¶Âá∫Â†¥„Åï„Åõ„Çà„ÅÜ„ÄÇÂÑ™Âãù„Åô„Çå„Å∞Â§ß„Åç„ÅèÊàêÈï∑„Åß„Åç„ÇãÔºÅ",
            action: "free"
        },
        6: {
            char: "Êé≤Á§∫Êùø",
            text: "„ÄêÊú¨Êó•ÈñãÂÇ¨„ÄëÂú∞Âå∫Ëã±Ë™û„Çπ„Éî„Éº„ÉÅ„Ç≥„É≥„ÉÜ„Çπ„Éà„ÄÇÂá∫Â†¥ËÄÖ2Âêç„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ„ÄÇ",
            action: "contest"
        },
        7: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "„Ç≥„É≥„ÉÜ„Çπ„Éà„ÅåÁµÇ„Çè„Çä„Åæ„Åó„Åü„Å≠ÔºÅÂæåÂçäÊà¶„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ",
            action: "free"
        },
        8: {
            char: "Âπ≥ÈáéÂÖàÁîü",
            text: "„ÅäÂâç„Åü„Å°„ÅåÊõ∏„ÅÑ„Åü„Çπ„Éî„Éº„ÉÅÂéüÁ®ø„ÅÆÊ∑ªÂâä„Åß„ÄÅÁßÅ„ÅÆËµ§„ÅÑ„Éö„É≥„Åå3Êú¨„ÇÇ„Ç§„É≥„ÇØÂàá„Çå„Å´„Å™„Å£„ÅüË≤¨‰ªª„ÅØÂèñ„Å£„Å¶„ÇÇ„Çâ„ÅÜ„Åû„ÄÇÊúÄÂæå„Åæ„ÅßÁ∂ö„Åë„Çç„ÄÇ",
            action: "free"
        },
        9: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "„ÇÇ„ÅÜ„Åô„ÅêÊúÄÁµÇÈÄ±„Å†„Å≠„ÄÇÊÇî„ÅÑ„ÅÆ„Å™„ÅÑ„Çà„ÅÜ„ÄÅÂÖ®Âäõ„ÅßÊ¥ªÂãï„Åó„Çà„ÅÜÔºÅ„ÅÇ„ÄÅÈÉ®Ë≤ª„Åå‰Ωô„Å£„Åü„ÇâÁßÅ„Å´ÈÇÑÂÖÉ„Åó„Å¶„ÇÇ„ÅÑ„ÅÑ„Çì„Å†„ÇàÔºü",
            action: "free"
        },
        10: {
            char: "ÂÖÉÈÉ®Èï∑",
            text: "ÊúÄÁµÇÈÄ±„Åß„ÅôÔºÅÁßÅ„Åü„Å°„ÅÆ„ÄéESS MANAGER„Äè„ÄÅÊúÄÈ´ò„ÅÆ„Ç®„É≥„Éá„Ç£„É≥„Ç∞„ÇíËøé„Åà„Åæ„Åó„Çá„ÅÜÔºÅ",
            action: "free"
        }
    };

    function initGame() {
        // ÁâπÊÄß„Å´ÊàêÈï∑Áéá„ÇíË®≠ÂÆö
        state.members.forEach(m => {
            const trait = traitData[m.trait];
            if (trait) {
                m.growthRate = trait.growthRate;
            }
            if (m.burnout === undefined) {
                m.burnout = false;
            }
        });
        
        document.getElementById('title-screen').classList.add('hidden');
        document.getElementById('game-main').classList.remove('hidden');
        loadWeek();
    }

    function loadWeek() {
        state.hasActed = false;
        
        // „Éê„Éº„É≥„Ç¢„Ç¶„Éà„ÉÅ„Çß„ÉÉ„ÇØ
        checkBurnout();
        
        const scenario = scenarios[state.week] || {
            char: "Nina",
            text: "‰ªäÈÄ±„ÇÇÈ†ëÂºµ„Çä„Åæ„Åó„Çá„ÅÜÔºÅ",
            action: "free"
        };

        document.getElementById('char-name').textContent = scenario.char;
        document.getElementById('story-text').textContent = scenario.text;
        
        if (scenario.action === "scout_required") {
            showScoutModal();
        } else if (scenario.action === "contest") {
            showContestModal();
        } else {
            renderActionButtons();
        }
        
        updateUI();
    }

    function checkBurnout() {
        let burnoutMessages = [];
        state.members.forEach(m => {
            if (m.stress >= 100 && !m.burnout) {
                m.burnout = true;
                m.eng = Math.floor(m.eng * 0.7); // Ëã±Ë™ûÂäõ30%Ê∏õÂ∞ë
                state.trust -= 15; // ‰ø°È†ºÂ∫¶‰Ωé‰∏ã
                burnoutMessages.push(`${m.name}„ÅåÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Å´„Å™„Å£„Å¶„Åó„Åæ„Å£„ÅüÔºÅÔºàËã±Ë™ûÂäõ-30%„ÄÅ‰ø°È†ºÂ∫¶-15Ôºâ`);
            }
        });
        
        if (burnoutMessages.length > 0) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2 style="margin-bottom: 20px; color: #f44336;">‚ö†Ô∏è Ë≠¶Âëä</h2>
                    <div class="burnout-warning">
                        ${burnoutMessages.join('<br>')}
                    </div>
                    <p style="margin: 15px 0;">ÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„ÅÆÈÉ®Âì°„ÅØÊàêÈï∑„Åß„Åç„Åæ„Åõ„Çì„ÄÇË¶™Áù¶‰ºö„Å™„Å©„Åß„Ç±„Ç¢„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                    <button onclick="this.closest('.modal').remove()" class="btn-next">Á¢∫Ë™ç</button>
                </div>
            `;
            document.body.appendChild(modal);
        }
    }

    function showScoutModal() {
        const modal = document.createElement('div');
        modal.className = 'modal';
        modal.innerHTML = `
            <div class="modal-content">
                <h2 style="margin-bottom: 20px; color: #587196;">Êñ∞ÂÖ•Áîü„Çπ„Ç´„Ç¶„Éà</h2>
                <p style="margin-bottom: 15px;">ÊúÄÂ§ß3Âêç„Åæ„ÅßÈÅ∏„Çì„Åß„Çπ„Ç´„Ç¶„Éà„Åß„Åç„Åæ„ÅôÔºàË≤ªÁî®Ôºö¬•500Ôºâ</p>
                <div id="recruit-list" class="member-grid"></div>
                <button id="confirm-scout" class="btn-next" style="margin-top: 20px;">Ê±∫ÂÆö</button>
            </div>
        `;
        document.body.appendChild(modal);

        const selectedRecruits = [];
        const recruitList = document.getElementById('recruit-list');
        
        // Êó¢Â≠ò„ÅÆÈÉ®Âì°Âêç„É™„Çπ„Éà„ÇíÂèñÂæó
        const existingNames = state.members.map(m => m.name);
        
        // Êó¢Â≠òÈÉ®Âì°„ÇíÈô§Â§ñ„Åó„ÅüÂÄôË£úËÄÖ„É™„Çπ„Éà
        const availableCandidates = recruitPool.filter(r => !existingNames.includes(r.name));
        const candidates = [...availableCandidates].sort(() => Math.random() - 0.5).slice(0, 6);
        
        candidates.forEach(r => {
            const trait = traitData[r.trait];
            const card = document.createElement('div');
            card.className = 'recruit-card';
            card.innerHTML = `
                <h4>${r.name}Ôºà${r.year}Âπ¥Ôºâ</h4>
                <div class="stat-label">Ëã±Ë™ûÂäõ: ${r.eng}</div>
                <div class="progress-bar"><div class="progress-fill" style="width:${r.eng/2}%"></div></div>
                <div class="stat-label">ÁâπÊÄß: <span class="trait-tag ${trait.cssClass}">${r.trait}</span></div>
                <div class="stat-label" style="font-size: 0.7em; color: #888;">${trait.desc}</div>
            `;
            card.onclick = () => {
                if (card.classList.contains('selected')) {
                    card.classList.remove('selected');
                    const idx = selectedRecruits.indexOf(r);
                    selectedRecruits.splice(idx, 1);
                } else if (selectedRecruits.length < 3) {
                    card.classList.add('selected');
                    selectedRecruits.push(r);
                }
            };
            recruitList.appendChild(card);
        });

        document.getElementById('confirm-scout').onclick = () => {
            if (selectedRecruits.length > 0) {
                state.budget -= 500;
                selectedRecruits.forEach(r => {
                    const trait = traitData[r.trait];
                    state.members.push({ 
                        ...r, 
                        stress: 0,
                        growthRate: trait.growthRate,
                        burnout: false
                    });
                });
                document.getElementById('story-text').textContent = `${selectedRecruits.map(r => r.name).join('„ÄÅ')}„ÅåÂÖ•ÈÉ®„Åó„Åæ„Åó„ÅüÔºÅ`;
            } else {
                document.getElementById('story-text').textContent = "‰ªäÂõû„ÅØ„Çπ„Ç´„Ç¶„Éà„ÇíË¶ãÈÄÅ„Çä„Åæ„Åó„Åü„ÄÇ";
            }
            document.body.removeChild(modal);
            state.hasActed = true;
            updateUI();
            renderActionButtons();
        };
    }

function showContestModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="margin-bottom: 20px; color: #5f8f8a;">„Ç≥„É≥„ÉÜ„Çπ„ÉàÂá∫Â†¥ËÄÖÈÅ∏Êäú</h2>
            <p style="margin-bottom: 15px;">ÂèÇÂä†Ë≤ª:¬•1000</p>
            <p style="margin-bottom: 15px;">2Âêç„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ(ÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„ÅÆÈÉ®Âì°„ÅØÈÅ∏„Åπ„Çã„Åæ„Åõ„Çì)</p>
            <div id="contest-list" class="member-grid"></div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
                <button id="confirm-contest" class="btn-next" disabled>Ê±∫ÂÆö</button>
                <button id="skip-contest" class="btn-choice">ÂèÇÂä†„Åó„Å™„ÅÑ</button>
            </div>
        </div>
    `;

    document.body.appendChild(modal);

    const selectedMembers = [];
    const contestList = document.getElementById('contest-list');

    // „ÄåÂèÇÂä†„Åó„Å™„ÅÑ„Äç„Éú„Çø„É≥„ÅÆÂá¶ÁêÜÔºàinnerHTML„ÅÆÂ§ñ„Å´Ë®òËø∞Ôºâ
    document.getElementById('skip-contest').onclick = () => {
        document.body.removeChild(modal);
        document.getElementById('story-text').textContent = "‰ªäÂõû„ÅØ„Ç≥„É≥„ÉÜ„Çπ„ÉàÂèÇÂä†„ÇíË¶ãÈÄÅ„Çä„Åæ„Åó„Åü„ÄÇ";
        state.hasActed = true;
        state.contestDone = true;
        updateUI();
        renderActionButtons();
    };

    // „É°„É≥„Éê„Éº„É™„Çπ„Éà„ÅÆÁîüÊàê
    state.members.forEach(m => {
        const trait = traitData[m.trait];
        const card = document.createElement('div');
        card.className = `member-card ${m.burnout ? 'burnout' : ''}`;
        card.innerHTML = `
            <h4>${m.name}Ôºà${m.year}Âπ¥Ôºâ${m.burnout ? ' üî•' : ''}</h4>
            <div class="stat-label">Ëã±Ë™ûÂäõ: ${m.eng}</div>
            <div class="progress-bar"><div class="progress-fill" style="width:${m.eng / 2}%"></div></div>
            <div class="stat-label">ÁâπÊÄß: <span class="trait-tag ${trait.cssClass}">${m.trait}</span></div>
            ${m.burnout ? '<div class="stat-label" style="color: #f44336;">ÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§</div>' : ''}
        `;

        if (!m.burnout) {
            card.onclick = () => {
                if (card.classList.contains('selected')) {
                    card.classList.remove('selected');
                    const idx = selectedMembers.indexOf(m);
                    if (idx > -1) selectedMembers.splice(idx, 1);
                } else if (selectedMembers.length < 2) {
                    card.classList.add('selected');
                    selectedMembers.push(m);
                }
                document.getElementById('confirm-contest').disabled = (selectedMembers.length !== 2);
            };
        } else {
            card.style.cursor = 'not-allowed';
            card.style.opacity = '0.6';
        }
        contestList.appendChild(card);
    });

    // „ÄåÊ±∫ÂÆö„Äç„Éú„Çø„É≥„ÅÆÂá¶ÁêÜ
    document.getElementById('confirm-contest').onclick = () => {
        if (state.budget < 1000) {
            alert('ÂèÇÂä†Ë≤ª„Åå‰∏çË∂≥„Åó„Å¶„ÅÑ„Åæ„Åô!');
            return;
        }

        state.budget -= 1000;
        const avgEng = (selectedMembers[0].eng + selectedMembers[1].eng) / 2;

        let winChance = Math.min(90, avgEng * 0.6);
        let secondChance = Math.min(95, avgEng * 0.75);

        const roll = Math.random() * 100;
        let result = "";
        let prize = 0;
        let engBonus = 0;
        let trustBonus = 0;

        if (roll < winChance) {
            result = "üèÜ ÂÑ™Âãù";
            prize = 5000;
            engBonus = 8;
            trustBonus = 30;
        } else if (roll < secondChance) {
            result = "ü•à Ê∫ñÂÑ™Âãù";
            prize = 2000;
            engBonus = 5;
            trustBonus = 15;
        } else {
            result = "üìù ÂèÇÂä†Ë≥û";
            prize = 500;
            engBonus = 3;
            trustBonus = 5;
        }

        // ÊàêÈï∑Âá¶ÁêÜ
        selectedMembers.forEach(m => {
            const growth = Math.floor(engBonus * m.growthRate);
            m.eng += growth;
            if (m.eng > 200) m.eng = 200;
        });

        state.budget += prize;
        state.trust += trustBonus;
        state.contestDone = true;
        state.hasActed = true;

        // „É¢„Éº„ÉÄ„É´ÂâäÈô§
        document.body.removeChild(modal);

        // ÁµêÊûúË°®Á§∫Áî®„É¢„Éº„ÉÄ„É´
        const resultModal = document.createElement('div');
        resultModal.className = 'modal';
        resultModal.innerHTML = `
            <div class="modal-content">
                <h2 style="margin-bottom: 20px; color: #607e8e;">„Ç≥„É≥„ÉÜ„Çπ„ÉàÁµêÊûú</h2>
                <div class="result-box" style="font-size: 1.5rem; text-align: center; margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">${result}</div>
                <p style="margin: 10px 0;">Âá∫Â†¥ËÄÖ: ${selectedMembers.map(m => m.name).join('„Å®')}</p>
                <p style="margin: 10px 0;">ÂèÇÂä†Ë≤ª: -¬•1000</p> 
                <p style="margin: 10px 0;">Áç≤ÂæóË≥ûÈáë: ¬•${prize}</p>
                <p style="margin: 10px 0;">ËÉΩÂäõ‰∏äÊòá: +${engBonus} (ÊàêÈï∑ÁéáÂèçÊò†Ê∏à„Åø)</p>
                <p style="margin: 10px 0;">‰ø°È†ºÂ∫¶‰∏äÊòá: +${trustBonus}</p>
                <button id="close-result" class="btn-next" style="margin-top: 20px;">Èñâ„Åò„Çã</button>
            </div>
        `;
        document.body.appendChild(resultModal);

        document.getElementById('close-result').onclick = () => {
            document.body.removeChild(resultModal);
            document.getElementById('story-text').textContent = `„Ç≥„É≥„ÉÜ„Çπ„Éà„Åß${result}„ÇíÁç≤Âæó„Åó„Åæ„Åó„ÅüÔºÅ`;
            updateUI();
            renderActionButtons();
        };
    };
}

    function renderActionButtons() {
        const panel = document.getElementById('action-panel');
        panel.innerHTML = '';

        const actions = [
            { id: 'train', name: "üìñ ÈÄöÂ∏∏ÁâπË®ì", cost: 200, color: 'btn-action' },
            { id: 'supertrain', name: "üî• Ë∂ÖÁâπË®ì", cost: 800, color: 'btn-action' },
            { id: 'work', name: "üíº ÁøªË®≥„Éê„Ç§„Éà", cost: 0, color: 'btn-action' },
            { id: 'hangout', name: "üé° Ë¶™Áù¶‰ºö", cost: 300, color: 'btn-action' },
            { id: 'scout', name: "üîç „Çπ„Ç´„Ç¶„Éà", cost: 500, color: 'btn-action' }
        ];

        actions.forEach(a => {
            const btn = document.createElement('button');
            btn.className = a.color;
            btn.textContent = a.cost > 0 ? `${a.name}(¬•${a.cost})` : a.name;
            btn.disabled = state.hasActed || (a.cost > 0 && state.budget < a.cost);
            btn.onclick = () => executeAction(a.id);
            panel.appendChild(btn);
        });

        const nextBtn = document.createElement('button');
        nextBtn.className = 'btn-next';
        nextBtn.textContent = state.hasActed ? "Ê¨°ÈÄ±„Å∏ÈÄ≤„ÇÄ ‚è≠Ô∏è" : "Ë°åÂãï„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ";
        nextBtn.disabled = !state.hasActed;
        nextBtn.onclick = nextWeek;
        panel.appendChild(nextBtn);
    }

    function executeAction(type) {
        if (state.hasActed) return;
        
        let msg = "";
        switch(type) {
            case 'train':
                state.budget -= 200;
                state.members.forEach(m => { 
                    if (!m.burnout) {
                        const trait = traitData[m.trait];
                        const growth = Math.floor(5 * m.growthRate);
                        m.eng += growth;
                        if (m.eng > 200) m.eng = 200;
                        m.stress += Math.floor(15 * trait.stressRate);
                    }
                });
                msg = "ÈÄöÂ∏∏ÁâπË®ì„ÅßËã±Ë™ûÂäõ„Åå‰∏ä„Åå„Å£„ÅüÔºÅ";
                break;
                
            case 'supertrain':
                state.budget -= 800;
                state.members.forEach(m => { 
                    if (!m.burnout) {
                        const trait = traitData[m.trait];
                        const growth = Math.floor(15 * m.growthRate);
                        m.eng += growth;
                        if (m.eng > 200) m.eng = 200;
                        m.stress += Math.floor(35 * trait.stressRate);
                    }
                });
                msg = "Ë∂ÖÁâπË®ì„Åß„Åã„Å™„ÇäËã±Ë™ûÂäõ„Åå‰∏ä„Åå„Å£„ÅüÔºÅÔºÅ";
                break;
                
            case 'scout':
                showScoutModal();
                return;
                
            case 'work':
                const reward = 800;
                state.budget += reward;
                state.members.forEach(m => {
                    const trait = traitData[m.trait];
                    m.stress += Math.floor(20 * trait.stressRate);
                });
                msg = `„Éê„Ç§„Éà„Åß¬•${reward}Á®º„Åé„Åæ„Åó„ÅüÔºÅ`;
                break;
                
            case 'hangout':
                state.budget -= 300;
                state.members.forEach(m => m.stress = Math.max(0, m.stress - 30));
                state.trust += 10;
                msg = "Ë¶™Áù¶‰ºö„Åß„Åø„Çì„Å™„ÅÆÁµÜ„ÅåÊ∑±„Åæ„Å£„ÅüÔºÅ";
                break;
        }

        state.hasActed = true;
        document.getElementById('story-text').textContent = msg;
        updateUI();
        renderActionButtons();
    }

    function nextWeek() {
        state.week++;
        if (state.week > state.maxWeek) {
            endYear();
        } else {
            loadWeek();
        }
    }

    function endYear() {
        const graduating = state.members.filter(m => m.year >= 5);
        const continuing = state.members.filter(m => m.year < 5);
        
        continuing.forEach(m => m.year++);
        
        const modal = document.createElement('div');
        modal.className = 'modal';
        
        let graduationMsg = "";
        if (graduating.length > 0) {
            graduationMsg = `<p style="color: #ff6f00; font-weight: bold; margin: 15px 0;">
                üéì ${graduating.map(m => m.name).join('„ÄÅ')}„ÅåÂçíÊ•≠„Åó„Åæ„Åó„Åü
            </p>`;
        updateGraduationStats(graduating.length);
        }
        
        modal.innerHTML = `
            <div class="modal-content">
                <h2 style="margin-bottom: 20px; color: #628c8b;">Âπ¥Â∫¶ÁµÇ‰∫Ü</h2>
                <div style="background: #f1f2f6; padding: 20px; border-radius: 10px; margin: 15px 0;">
                    <p style="font-size: 1.3em; margin: 10px 0;">Á¨¨${state.year}Âπ¥Â∫¶„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü</p>
                    ${graduationMsg}
                    <p style="margin: 10px 0;">Á∂ôÁ∂öÈÉ®Âì°: ${continuing.length}Âêç</p>
                    <p style="margin: 10px 0;">Âπ≥ÂùáËã±Ë™ûÂäõ: ${Math.floor(continuing.reduce((a, b) => a + b.eng, 0) / Math.max(continuing.length, 1))}</p>
                    <p style="margin: 10px 0;">ÁèæÂú®„ÅÆÈÉ®Ë≤ª: ¬•${state.budget}</p>
                    <p style="margin: 10px 0;">‰ø°È†ºÂ∫¶: ${state.trust}</p>
                </div>
                <button id="continue-next-year" class="btn-next" style="margin: 10px 0;">Ê¨°„ÅÆÂπ¥Â∫¶„Å∏ÈÄ≤„ÇÄ</button>
                <button id="end-game-now" class="btn-choice" style="margin: 10px 0;">Ê¥ªÂãï„ÇíÁµÇ‰∫Ü„Åô„Çã</button>
            </div>
        `;
        document.body.appendChild(modal);
        
        document.getElementById('continue-next-year').onclick = () => {
            state.year++;
            state.week = 1;
            state.members = continuing;
            state.hasActed = false;
            state.contestDone = false;
            // Ê¨°„ÅÆÂπ¥Â∫¶„Å´Âêë„Åë„Åü„Éú„Éº„Éä„ÇπÔºà‰ø°È†ºÂ∫¶„Å´Âøú„Åò„Å¶‰∫àÁÆóËøΩÂä†„Å™„Å©Ôºâ
            state.budget += state.trust * 10;
            
            document.body.removeChild(modal);
            initGame(); // Êñ∞„Åó„ÅÑÂπ¥Â∫¶„Å®„Åó„Å¶ÂàùÊúüÂåñÔºà„Åæ„Åü„ÅØloadWeekÔºâ
        };

        document.getElementById('end-game-now').onclick = () => {
            location.reload(); // „Çø„Ç§„Éà„É´„Å´Êàª„Çã
        };
    }

    function updateUI() {
        // „Çπ„ÉÜ„Éº„Çø„Çπ„Éê„Éº„ÅÆÊõ¥Êñ∞
        document.getElementById('display-week').textContent = `Á¨¨ ${state.week} ÈÄ±`;
        document.getElementById('stat-year').textContent = `${state.year}Âπ¥ÁõÆ`;
        document.getElementById('stat-budget').textContent = `¬•${state.budget}`;
        document.getElementById('stat-members').textContent = `${state.members.length}‰∫∫`;
        
        const avgEng = state.members.length > 0 
            ? Math.floor(state.members.reduce((sum, m) => sum + m.eng, 0) / state.members.length) 
            : 0;
        document.getElementById('stat-eng').textContent = avgEng;
        document.getElementById('stat-trust').textContent = state.trust;

        // ÈÉ®Âì°„É™„Çπ„Éà„ÅÆË°®Á§∫Êõ¥Êñ∞
        const memberList = document.getElementById('member-list');
        memberList.innerHTML = '';
        
        state.members.forEach(m => {
            const trait = traitData[m.trait] || { cssClass: 'trait-steady', desc: 'Ê®ôÊ∫ñ' };
            const card = document.createElement('div');
            card.className = `member-card ${m.year >= 5 ? 'graduating' : ''}`;
            card.innerHTML = `
                <div class="char-name">${m.name} (${m.year}Âπ¥Áîü)</div>
                <div class="stat-label">Ëã±Ë™ûÂäõ: ${m.eng}</div>
                <div class="progress-bar"><div class="progress-fill" style="width:${m.eng}%"></div></div>
                <div class="stat-label">„Çπ„Éà„É¨„Çπ: ${m.stress}</div>
                <div class="progress-bar"><div class="progress-fill" style="width:${m.stress}%; background:#ff4757;"></div></div>
                <div class="stat-label">ÁâπÊÄß: <span class="trait-tag ${trait.cssClass}">${m.trait}</span></div>
            `;
            memberList.appendChild(card);
        });
    }

    // Ëµ∑ÂãïÊôÇ„Å´„Çø„Ç§„Éà„É´ÁîªÈù¢„ÇíË°®Á§∫
    window.onload = () => {
        document.getElementById('game-main').classList.add('hidden');
    };
    
    
    
    // ============================================
// 1. „Çª„Éº„Éñ/„É≠„Éº„ÉâÊ©üËÉΩ
// ============================================

function saveGame() {
    const saveData = {
        state: state,
        timestamp: new Date().toISOString(),
        version: "1.0"
    };
    
    const saveSlots = JSON.parse(localStorage.getItem('essManagerSaves')) || {};
    const slotKey = `slot_${Date.now()}`;
    saveSlots[slotKey] = saveData;
    
    // ÊúÄÂ§ß5ÂÄã„ÅÆ„Çª„Éº„Éñ„Éá„Éº„Çø„Çí‰øùÊåÅ
    const slots = Object.keys(saveSlots);
    if (slots.length > 5) {
        delete saveSlots[slots[0]];
    }
    
    localStorage.setItem('essManagerSaves', JSON.stringify(saveSlots));
    
    showNotification("üíæ „Ç≤„Éº„É†„Çí„Çª„Éº„Éñ„Åó„Åæ„Åó„ÅüÔºÅ", "success");
}

function loadGame() {
    const saveSlots = JSON.parse(localStorage.getItem('essManagerSaves')) || {};
    
    if (Object.keys(saveSlots).length === 0) {
        showNotification("üìÇ „Çª„Éº„Éñ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì", "info");
        return;
    }
    
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">„É≠„Éº„Éâ</h2>
            <div id="save-slot-list"></div>
            <button onclick="this.closest('.modal').remove()" class="btn-choice" style="margin-top: 20px;">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    const slotList = document.getElementById('save-slot-list');
    
    Object.entries(saveSlots).reverse().forEach(([key, data]) => {
        const date = new Date(data.timestamp);
        const slot = document.createElement('div');
        slot.className = 'save-slot';
        slot.innerHTML = `
            <div class="save-slot-header">
                <div class="save-slot-title">Á¨¨${data.state.year}Âπ¥Â∫¶ Á¨¨${data.state.week}ÈÄ±</div>
                <div class="save-slot-date">${date.toLocaleDateString()} ${date.toLocaleTimeString()}</div>
            </div>
            <div class="save-slot-info">
                <span>ÈÉ®Âì°: ${data.state.members.length}‰∫∫</span>
                <span>ÈÉ®Ë≤ª: ¬•${data.state.budget}</span>
                <span>‰ø°È†º: ${data.state.trust}</span>
            </div>
        `;
        slot.onclick = () => {
            Object.assign(state, data.state);
            document.body.removeChild(modal);
            document.getElementById('title-screen').classList.add('hidden');
            document.getElementById('game-main').classList.remove('hidden');
            loadWeek();
            showNotification("üìÇ „Ç≤„Éº„É†„Çí„É≠„Éº„Éâ„Åó„Åæ„Åó„ÅüÔºÅ", "success");
        };
        slotList.appendChild(slot);
    });
}

// Á∞°ÊòìÈÄöÁü•„Ç∑„Çπ„ÉÜ„É†
function showNotification(message, type = "info") {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: ${type === 'success' ? '#4caf50' : type === 'error' ? '#f44336' : '#2196f3'};
        color: white;
        padding: 15px 25px;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 4000;
        animation: notificationSlideIn 0.3s ease;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'notificationSlideIn 0.3s ease reverse';
        setTimeout(() => notification.remove(), 300);
    }, 2000);
}

// ============================================
// ÂÆüÁ∏æ„Ç∑„Çπ„ÉÜ„É†Ôºà‰øÆÊ≠£ÁâàÔºâ
// ============================================

const achievements = {
    perfect_year: {
        id: "perfect_year",
        name: "ÂÆåÁíß„Å™Âπ¥Â∫¶ÈÅãÂñ∂",
        desc: "Âπ¥Â∫¶ÁµÇ‰∫ÜÊôÇ„Å´ÂÖ®Âì°„Çπ„Éà„É¨„Çπ50‰ª•‰∏ã",
        icon: "‚≠ê",
        unlocked: false,
        unlockedDate: null
    },
    english_master: {
        id: "english_master",
        name: "Ëã±Ë™û„Éû„Çπ„Çø„Éº",
        desc: "ÂÖ®Âì°„ÅÆËã±Ë™ûÂäõ„Çí50‰ª•‰∏ä„Å´„Åô„Çã",
        icon: "üìö",
        unlocked: false,
        unlockedDate: null
    },
    rich_club: {
        id: "rich_club",
        name: "Ë≥áÈáëÊΩ§Ê≤¢",
        desc: "ÈÉ®Ë≤ª„Åå10000ÂÜÜ‰ª•‰∏ä„Å´„Å™„Çã",
        icon: "üí∞",
        unlocked: false,
        unlockedDate: null
    },
    trust_max: {
        id: "trust_max",
        name: "Áµ∂ÂØæÁöÑ‰ø°È†º",
        desc: "‰ø°È†ºÂ∫¶„Åå100‰ª•‰∏ä„Å´„Å™„Çã",
        icon: "‚ù§Ô∏è",
        unlocked: false,
        unlockedDate: null
    },
    big_club: {
        id: "big_club",
        name: "Â§ßÊâÄÂ∏Ø",
        desc: "ÈÉ®Âì°„Åå10‰∫∫‰ª•‰∏ä„Å´„Å™„Çã",
        icon: "üë•",
        unlocked: false,
        unlockedDate: null
    },
    no_burnout: {
        id: "no_burnout",
        name: "ÁáÉ„ÅàÂ∞Ω„ÅçÂõûÈÅø",
        desc: "1Âπ¥ÈñìË™∞„ÇÇÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Å´„Å™„Çâ„Å™„ÅÑ",
        icon: "üõ°Ô∏è",
        unlocked: false,
        unlockedDate: null
    },
    super_growth: {
        id: "super_growth",
        name: "ÊÄ•ÊàêÈï∑",
        desc: "1‰∫∫„ÅÆÈÉ®Âì°„ÅÆËã±Ë™ûÂäõ„Çí1Âπ¥„Åß30‰ª•‰∏ä‰∏ä„Åí„Çã",
        icon: "üìà",
        unlocked: false,
        unlockedDate: null
    },
    stress_free: {
        id: "stress_free",
        name: "„Çπ„Éà„É¨„Çπ„Éï„É™„Éº",
        desc: "ÂÖ®Âì°„ÅÆ„Çπ„Éà„É¨„Çπ„Çí0„Å´„Åô„Çã",
        icon: "üòä",
        unlocked: false,
        unlockedDate: null
    },
    elite_team: {
        id: "elite_team",
        name: "„Ç®„É™„Éº„ÉàÈõÜÂõ£",
        desc: "Âπ≥ÂùáËã±Ë™ûÂäõ„Åå100„ÇíË∂Ö„Åà„Çã",
        icon: "üåü",
        unlocked: false,
        unlockedDate: null
    },
    close_call: {
        id: "close_call",
        name: "Âç±Ê©ü‰∏ÄÈ´™",
        desc: "„Çπ„Éà„É¨„Çπ90‰ª•‰∏ä„ÅÆÈÉ®Âì°„Åå„ÅÑ„ÇãÁä∂ÊÖã„Åã„ÇâÁáÉ„ÅàÂ∞Ω„ÅçÂõûÈÅø",
        icon: "‚ö°",
        unlocked: false,
        unlockedDate: null
    },
    diversity: {
        id: "diversity",
        name: "Â§öÊßòÊÄß",
        desc: "5Á®ÆÈ°û‰ª•‰∏ä„ÅÆÁï∞„Å™„ÇãÁâπÊÄß„ÇíÊåÅ„Å§ÈÉ®Âì°„ÇíÈõÜ„ÇÅ„Çã",
        icon: "üåà",
        unlocked: false,
        unlockedDate: null
    },
    legend: {
        id: "legend",
        name: "„É¨„Ç∏„Çß„É≥„Éâ",
        desc: "5Âπ¥ÁõÆ„Å´Âà∞ÈÅî„Åô„Çã",
        icon: "üèÜ",
        unlocked: false,
        unlockedDate: null
    },
    educator: {
        id: "educator",
        name: "ÊïôËÇ≤ËÄÖ",
        desc: "Á¥ØË®à„Åß20‰∫∫‰ª•‰∏ä„ÅÆÈÉ®Âì°„ÇíÂçíÊ•≠„Åï„Åõ„Çã",
        icon: "üìö",
        unlocked: false,
        unlockedDate: null
    },
    chaos: {
        id: "chaos",
        name: "„Ç´„Ç™„Çπ",
        desc: "ÂÖ®Âì°„Åå„Çπ„Éà„É¨„Çπ80‰ª•‰∏ä„ÅÆÁä∂ÊÖã„Çí‰Ωú„Çã",
        icon: "üò±",
        unlocked: false,
        unlockedDate: null
    }
    
};

// „Ç∞„É≠„Éº„Éê„É´Á¥ØË®à„Éá„Éº„ÇøÔºà„Çª„Éº„Éñ„Éá„Éº„Çø„Å®„ÅØÂà•„Å´Ê∞∏Á∂öÂåñÔºâ
let globalStats = {
    totalGraduates: 0,
    totalBudgetEarned: 0,
    hasHadHighStress: false, // Âç±Ê©ü‰∏ÄÈ´™„Éï„É©„Ç∞
    hasHadChaos: false // „Ç´„Ç™„Çπ„Éï„É©„Ç∞
};

// „Ç∞„É≠„Éº„Éê„É´Áµ±Ë®à„ÅÆË™≠„ÅøËæº„Åø
function loadGlobalStats() {
    const saved = localStorage.getItem('essManagerGlobalStats');
    if (saved) {
        globalStats = JSON.parse(saved);
    }
}

// „Ç∞„É≠„Éº„Éê„É´Áµ±Ë®à„ÅÆ‰øùÂ≠ò
function saveGlobalStats() {
    localStorage.setItem('essManagerGlobalStats', JSON.stringify(globalStats));
}

// ÂÆüÁ∏æ„Éá„Éº„Çø„Çí„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Åã„ÇâË™≠„ÅøËæº„Åø
function loadAchievements() {
    const saved = localStorage.getItem('essManagerAchievements');
    if (saved) {
        const savedData = JSON.parse(saved);
        Object.keys(savedData).forEach(key => {
            if (achievements[key]) {
                achievements[key].unlocked = savedData[key].unlocked;
                achievements[key].unlockedDate = savedData[key].unlockedDate;
            }
        });
    }
    loadGlobalStats();
    updateAchievementCount();
}

// ÂÆüÁ∏æ„Éá„Éº„Çø„Çí‰øùÂ≠ò
function saveAchievements() {
    localStorage.setItem('essManagerAchievements', JSON.stringify(achievements));
    saveGlobalStats();
}

// ÈÉ®Âì°„ÅÆÂàùÊúüËã±Ë™ûÂäõ„ÇíË®òÈå≤ÔºàÊñ∞ÊòüÁô∫ÊéòÁî®Ôºâ
function trackMemberInitialStats() {
    state.members.forEach(m => {
        if (m.initialEng === undefined) {
            m.initialEng = m.eng;
        }
    });
}

// ÂÆüÁ∏æ„ÉÅ„Çß„ÉÉ„ÇØ
function checkAchievements() {
    // ÂÆåÁíß„Å™Âπ¥Â∫¶ÈÅãÂñ∂
    if (!achievements.perfect_year.unlocked && state.week === state.maxWeek) {
        const allLowStress = state.members.every(m => m.stress <= 50);
        if (allLowStress) {
            unlockAchievement('perfect_year');
        }
    }
    
    // Ëã±Ë™û„Éû„Çπ„Çø„Éº
    if (!achievements.english_master.unlocked) {
        const allHighEng = state.members.length > 0 && state.members.every(m => m.eng >= 50);
        if (allHighEng) {
            unlockAchievement('english_master');
        }
    }
    
    
    // Áµ∂ÂØæÁöÑ‰ø°È†º
    if (!achievements.trust_max.unlocked && state.trust >= 100) {
        unlockAchievement('trust_max');
    }
    
    // Â§ßÊâÄÂ∏Ø
    if (!achievements.big_club.unlocked && state.members.length >= 10) {
        unlockAchievement('big_club');
    }
    
    // ÁáÉ„ÅàÂ∞Ω„ÅçÂõûÈÅø
    if (!achievements.no_burnout.unlocked && state.week === state.maxWeek) {
        const noBurnout = state.members.every(m => !m.burnout);
        if (noBurnout) {
            unlockAchievement('no_burnout');
        }
    }
    
    // „Çπ„Éà„É¨„Çπ„Éï„É™„Éº
    if (!achievements.stress_free.unlocked) {
        const allZeroStress = state.members.length > 0 && state.members.every(m => m.stress === 0);
        if (allZeroStress) {
            unlockAchievement('stress_free');
        }
    }
    
    // „Ç®„É™„Éº„ÉàÈõÜÂõ£
    if (!achievements.elite_team.unlocked && state.members.length > 0) {
        const avgEng = state.members.reduce((sum, m) => sum + m.eng, 0) / state.members.length;
        if (avgEng >= 100) {
            unlockAchievement('elite_team');
        }
    }
    
    // Âç±Ê©ü‰∏ÄÈ´™Ôºà„Çπ„Éà„É¨„Çπ90‰ª•‰∏ä„ÅÆÈÉ®Âì°„Åå„ÅÑ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØÔºâ
    const hasHighStress = state.members.some(m => m.stress >= 90);
    if (hasHighStress) {
        globalStats.hasHadHighStress = true;
        saveGlobalStats();
    }
    
    // Âç±Ê©ü‰∏ÄÈ´™ÔºàÂπ¥Â∫¶ÁµÇ‰∫ÜÊôÇ„Å´ÁáÉ„ÅàÂ∞Ω„ÅçÁÑ°„Åó„Åß„ÇØ„É™„Ç¢Ôºâ
    if (!achievements.close_call.unlocked && state.week === state.maxWeek) {
        const noBurnout = state.members.every(m => !m.burnout);
        if (noBurnout && globalStats.hasHadHighStress) {
            unlockAchievement('close_call');
            globalStats.hasHadHighStress = false; // „É™„Çª„ÉÉ„Éà
            saveGlobalStats();
        }
    }
    
    // Â§öÊßòÊÄßÔºà5Á®ÆÈ°û‰ª•‰∏ä„ÅÆÁï∞„Å™„ÇãÁâπÊÄßÔºâ
    if (!achievements.diversity.unlocked && state.members.length >= 5) {
        const uniqueTraits = new Set(state.members.map(m => m.trait));
        if (uniqueTraits.size >= 5) {
            unlockAchievement('diversity');
        }
    }
   
    
    // „É¨„Ç∏„Çß„É≥„ÉâÔºà5Âπ¥ÁõÆÂà∞ÈÅîÔºâ
    if (!achievements.legend.unlocked && state.year >= 5) {
        unlockAchievement('legend');
    }
    
    // ÊïôËÇ≤ËÄÖÔºàÁ¥ØË®à20‰∫∫‰ª•‰∏äÂçíÊ•≠Ôºâ
    if (!achievements.educator.unlocked && globalStats.totalGraduates >= 20) {
        unlockAchievement('educator');
    }
    

    // „Ç´„Ç™„ÇπÔºàÂÖ®Âì°„Åå„Çπ„Éà„É¨„Çπ80‰ª•‰∏äÔºâ
    if (!achievements.chaos.unlocked && state.members.length > 0) {
        const allHighStress = state.members.every(m => m.stress >= 80);
        if (allHighStress && !globalStats.hasHadChaos) {
            unlockAchievement('chaos');
            globalStats.hasHadChaos = true;
            saveGlobalStats();
        }
    }
}

// ÂÆüÁ∏æËß£Èô§
function unlockAchievement(id) {
    if (!achievements[id] || achievements[id].unlocked) return;
    
    achievements[id].unlocked = true;
    achievements[id].unlockedDate = new Date().toISOString();
    saveAchievements();
    updateAchievementCount();
    
    // ÈÄöÁü•Ë°®Á§∫
    const notification = document.getElementById('achievement-notification');
    notification.querySelector('.notification-desc').textContent = achievements[id].name;
    notification.classList.remove('hidden');
    
    setTimeout(() => {
        notification.classList.add('hidden');
    }, 4000);
}

// ÂÆüÁ∏æ„Ç´„Ç¶„É≥„ÉàÊõ¥Êñ∞
function updateAchievementCount() {
    const total = Object.keys(achievements).length;
    const unlocked = Object.values(achievements).filter(a => a.unlocked).length;
    const badge = document.getElementById('achievement-count');
    if (badge) {
        badge.textContent = `${unlocked}/${total}`;
    }
}

// ÂÆüÁ∏æ„É¢„Éº„ÉÄ„É´Ë°®Á§∫
function showAchievementModal() {
    const modal = document.createElement('div');
    modal.className = 'modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">üèÜ ÂÆüÁ∏æ‰∏ÄË¶ß</h2>
            <div class="achievement-grid" id="achievement-grid"></div>
            <button onclick="this.closest('.modal').remove()" class="btn-next" style="margin-top: 20px;">Èñâ„Åò„Çã</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    const grid = document.getElementById('achievement-grid');
    
    Object.values(achievements).forEach(ach => {
        const card = document.createElement('div');
        card.className = `achievement-card ${ach.unlocked ? 'unlocked' : 'locked'}`;
        
        let dateStr = '';
        if (ach.unlocked && ach.unlockedDate) {
            const date = new Date(ach.unlockedDate);
            dateStr = `<div class="achievement-date">Ëß£Èô§Êó•: ${date.toLocaleDateString()}</div>`;
        }
        
        card.innerHTML = `
            <div class="achievement-icon">${ach.icon}</div>
            <div class="achievement-name">${ach.name}</div>
            <div class="achievement-desc">${ach.desc}</div>
            ${dateStr}
        `;
        grid.appendChild(card);
    });
}

// ÂçíÊ•≠Âá¶ÁêÜÊôÇ„Å´Âëº„Å≥Âá∫„ÅôÈñ¢Êï∞ÔºàendYearÈñ¢Êï∞ÂÜÖ„Åß‰ΩøÁî®Ôºâ
function updateGraduationStats(graduatingCount) {
    globalStats.totalGraduates += graduatingCount;
    saveGlobalStats();
}

// ÈÉ®Ë≤ªÁç≤ÂæóÊôÇ„Å´Âëº„Å≥Âá∫„ÅôÈñ¢Êï∞ÔºàexecuteAction„ÄÅ„Ç≥„É≥„ÉÜ„Çπ„ÉàÂ†±ÈÖ¨„Å™„Å©„Åß‰ΩøÁî®Ôºâ
function updateBudgetStats(amount) {
    if (amount > 0) {
        globalStats.totalBudgetEarned += amount;
        saveGlobalStats();
    }
}


// ============================================
// 3. „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà„Ç∑„Çπ„ÉÜ„É†
// ============================================

const randomEvents = [
    {
        id: "festival_prep",
        name: "Â≠¶ÂúíÁ•≠Ê∫ñÂÇô„ÅÆ‰æùÈ†º",
        desc: "ÁîüÂæí‰ºö„Åã„Çâ„ÄåËã±Ë™û„Åß„ÅÆ„Ç¢„Éä„Ç¶„É≥„Çπ„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„ÅôÔºÅ„Äç„Å®È†º„Åæ„Çå„Åæ„Åó„Åü„ÄÇ",
        icon: "üé™",
        type: "neutral",
        chance: 0.15,
        effects: {
            stress: 20,
            trust: 15
        },
        message: "„Çπ„Éà„É¨„Çπ+20„ÄÅ‰ø°È†ºÂ∫¶+15"
    },
    {
        id: "teacher_gift",
        name: "ÂÖàÁîü„ÅÆÂ∑Æ„ÅóÂÖ•„Çå",
        desc: "Âπ≥ÈáéÂÖàÁîü„Åå„Äå„Åü„Åæ„Å´„ÅØ‰ºë„ÇÅ„Äç„Å®„ÅäËèìÂ≠ê„ÇíÂ∑Æ„ÅóÂÖ•„Çå„Å¶„Åè„Çå„Åæ„Åó„Åü„ÄÇ",
        icon: "üç∞",
        type: "positive",
        chance: 0.12,
        effects: {
            stress: -10
        },
        message: "ÂÖ®Âì°„ÅÆ„Çπ„Éà„É¨„Çπ-10"
    },
    {
        id: "flu_outbreak",
        name: "„Ç§„É≥„Éï„É´„Ç®„É≥„Ç∂ÊµÅË°å",
        desc: "Â≠¶Ê†°„Åß„Ç§„É≥„Éï„É´„Ç®„É≥„Ç∂„ÅåÊµÅË°å‰∏≠„ÄÇ„É©„É≥„ÉÄ„É†„Å™ÈÉ®Âì°„Åå1ÈÄ±Èñì‰ºë„ÇÄ„Åì„Å®„Å´‚Ä¶",
        icon: "ü§í",
        type: "negative",
        chance: 0.1,
        effects: {
            absentee: 1
        },
        message: "1Âêç„ÅåÊ¨†Â∏≠"
    },
    {
        id: "english_camp",
        name: "Ëã±Ë™û„Ç≠„É£„É≥„Éó„ÅÆË™ò„ÅÑ",
        desc: "ËøëÈö£Ê†°„Å®ÂêàÂêå„ÅßËã±Ë™û„Ç≠„É£„É≥„Éó„ÇíÈñãÂÇ¨„Åô„Çã„Å®„ÅÆ„Åì„Å®„ÄÇ",
        icon: "üèïÔ∏è",
        type: "positive",
        chance: 0.08,
        effects: {
            eng: 8,
            stress: 15,
            budget: -300
        },
        message: "Ëã±Ë™ûÂäõ+8„ÄÅ„Çπ„Éà„É¨„Çπ+15„ÄÅÈÉ®Ë≤ª-¬•300"
    },
    {
        id: "equipment_broken",
        name: "Ê©üÊùê„ÅÆÊïÖÈöú",
        desc: "„Éó„É≠„Ç∏„Çß„ÇØ„Çø„Éº„ÅåÊïÖÈöú„Åó„Å¶„Åó„Åæ„ÅÑ„Åæ„Åó„Åü„ÄÇ‰øÆÁêÜ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ",
        icon: "üíî",
        type: "negative",
        chance: 0.1,
        effects: {
            budget: -1400
        },
        message: "ÈÉ®Ë≤ª-¬•1400"
    },
    {
        id: "alumni_visit",
        name: "OB„ÉªOG„ÅÆË®™Âïè",
        desc: "ÂçíÊ•≠Áîü„ÅåË®™„Å≠„Å¶„Åç„Å¶„ÄÅÂä±„Åæ„Åó„ÅÆË®ÄËëâ„Å®„ÅäÈáë„Çí„Åè„Çå„Åæ„Åó„ÅüÔºÅ",
        icon: "üëã",
        type: "positive",
        chance: 0.1,
        effects: {
            budget: 600,
            trust: 5
        },
        message: "ÈÉ®Ë≤ª+¬•600„ÄÅ‰ø°È†ºÂ∫¶+5"
    },
    {
        id: "rainy_week",
        name: "ÈÄ£Êó•„ÅÆÈõ®",
        desc: "1ÈÄ±Èñì„Åö„Å£„Å®Èõ®„ÅßÊ∞óÂàÜ„ÅåÊô¥„Çå„Åæ„Åõ„Çì‚Ä¶„Åø„Çì„Å™„ÅÆ„É¢„ÉÅ„Éô„Éº„Ç∑„Éß„É≥„Åå‰∏ã„Åå„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
        icon: "üåßÔ∏è",
        type: "negative",
        chance: 0.1,
        effects: {
            stress: 10,
            trust: -5
        },
        message: "„Çπ„Éà„É¨„Çπ+10„ÄÅ‰ø°È†ºÂ∫¶-5"
    },
    {
        id: "motivational_speaker",
        name: "ÁâπÂà•Ë¨õÂ∏´„ÅÆË®™Âïè",
        desc: "„Éó„É≠„ÅÆÈÄöË®≥ËÄÖ„ÅåÁâπÂà•Ë¨õÁæ©„Çí„Åó„Å¶„Åè„Çå„Çã„Åì„Å®„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅ",
        icon: "üé§",
        type: "positive",
        chance: 0.08,
        effects: {
            eng: 5,
            trust: 5
        },
        message: "Ëã±Ë™ûÂäõ+5„ÄÅ‰ø°È†ºÂ∫¶+5"
    }
];

// „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„ÉàÊäΩÈÅ∏
function checkRandomEvent() {
    // 20%„ÅÆÁ¢∫Áéá„Åß„Ç§„Éô„É≥„ÉàÂà§ÂÆö
    if (Math.random() > 0.2) return null;
    
    const availableEvents = randomEvents.filter(e => Math.random() < e.chance);
    if (availableEvents.length === 0) return null;
    
    return availableEvents[Math.floor(Math.random() * availableEvents.length)];
}

// „Ç§„Éô„É≥„ÉàÂÆüË°å
function triggerRandomEvent(event) {
    const modal = document.createElement('div');
    modal.className = 'modal event-card-modal';
    modal.innerHTML = `
        <div class="modal-content event-card ${event.type}">
            <div class="event-icon">${event.icon}</div>
            <div class="event-title">${event.name}</div>
            <div class="event-description">${event.desc}</div>
            <div class="event-effects">
                <div class="event-effect-item">
                    <span>ÂäπÊûú:</span>
                    <span class="${event.type === 'positive' ? 'event-effect-positive' : event.type === 'negative' ? 'event-effect-negative' : ''}">${event.message}</span>
                </div>
            </div>
            <button onclick="applyEventEffects(this, ${JSON.stringify(event).replace(/"/g, '&quot;')})" class="btn-next">‰∫ÜËß£</button>
        </div>
    `;
    document.body.appendChild(modal);
}

// „Ç§„Éô„É≥„ÉàÂäπÊûúÈÅ©Áî®
function applyEventEffects(button, event) {
    const effects = event.effects;
    
    state.members.forEach(m => {
        if (effects.stress) m.stress = Math.max(0, Math.min(100, m.stress + effects.stress));
        if (effects.eng && !m.burnout) {
            const growth = Math.floor(effects.eng * m.growthRate);
            m.eng = Math.min(200, m.eng + growth);
        }
    });
    
    if (effects.trust) state.trust = Math.max(0, state.trust + effects.trust);
    if (effects.budget) state.budget += effects.budget;
    
    if (effects.absentee) {
        const availableMembers = state.members.filter(m => !m.burnout);
        if (availableMembers.length > 0) {
            const absentee = availableMembers[Math.floor(Math.random() * availableMembers.length)];
            absentee.stress += 10; // Ê¨†Â∏≠„Å´„Çà„Çã„Çπ„Éà„É¨„Çπ
        }
    }
    
    button.closest('.modal').remove();
    updateUI();
}

// ============================================
// Êó¢Â≠òÈñ¢Êï∞„Å∏„ÅÆÁµ±Âêà
// ============================================

// initGameÈñ¢Êï∞„Å´ËøΩÂä†
const originalInitGame = window.initGame;
window.initGame = function() {
    loadAchievements();
    if (originalInitGame) originalInitGame();
};

// loadWeekÈñ¢Êï∞„Å´ËøΩÂä†Ôºà„É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà„ÉÅ„Çß„ÉÉ„ÇØÔºâ
const originalLoadWeek = window.loadWeek;
window.loadWeek = function() {
    if (originalLoadWeek) originalLoadWeek();
    
    // „É©„É≥„ÉÄ„É†„Ç§„Éô„É≥„Éà„ÉÅ„Çß„ÉÉ„ÇØÔºàÁ¨¨1ÈÄ±„Å®ÊúÄÁµÇÈÄ±‰ª•Â§ñÔºâ
    if (state.week > 1 && state.week < state.maxWeek) {
        const event = checkRandomEvent();
        if (event) {
            setTimeout(() => triggerRandomEvent(event), 500);
        }
    }
    
    // ÂÆüÁ∏æ„ÉÅ„Çß„ÉÉ„ÇØ
    checkAchievements();
};

// updateUIÈñ¢Êï∞„Å´ÂÆüÁ∏æ„ÉÅ„Çß„ÉÉ„ÇØ„ÇíËøΩÂä†
const originalUpdateUI = window.updateUI;
window.updateUI = function() {
    if (originalUpdateUI) originalUpdateUI();
    checkAchievements();
};
    
  // ============================================
// „Ç∑„Éß„ÉÉ„ÉóÊ©üËÉΩÔºà„Éù„ÉÉ„Éó„Ç¢„ÉÉ„ÉóÁâàÔºâ
// ============================================

// „Ç¢„Ç§„ÉÜ„É†„Éá„Éº„Çø„Éô„Éº„Çπ
const shopItems = {
    stress_relief: {
        id: "stress_relief",
        name: "„É™„É©„ÉÉ„ÇØ„Çπ„ÉÜ„Ç£„Éº",
        desc: "„Çπ„Éà„É¨„Çπ„Çí30Ê∏õÂ∞ë",
        icon: "üçµ",
        price: 500,
        effect: (member) => {
            member.stress = Math.max(0, member.stress - 30);
            return `${member.name}„ÅÆ„Çπ„Éà„É¨„Çπ„Åå30Ê∏õÂ∞ë„Åó„Åæ„Åó„ÅüÔºÅ`;
        }
    },
    energy_drink: {
        id: "energy_drink",
        name: "„Ç®„Éä„Ç∏„Éº„Éâ„É™„É≥„ÇØ",
        desc: "Ëã±Ë™ûÂäõ+10„ÄÅ„Çπ„Éà„É¨„Çπ+5",
        icon: "‚ö°",
        price: 700,
        effect: (member) => {
            if (!member.burnout) {
                const growth = Math.floor(10 * member.growthRate);
                member.eng = Math.min(200, member.eng + growth);
                member.stress = Math.min(100, member.stress + 5);
                return `${member.name}„ÅÆËã±Ë™ûÂäõ„Åå${growth}‰∏äÊòá„Åó„Åæ„Åó„ÅüÔºÅ`;
            }
            return `${member.name}„ÅØÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Å™„ÅÆ„ÅßÂäπÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì...`;
        }
    },
    motivational_book: {
        id: "motivational_book",
        name: "Ëá™Â∑±ÂïìÁô∫Êú¨",
        desc: "Ëã±Ë™ûÂäõ+5„ÄÅ„Çπ„Éà„É¨„Çπ-10",
        icon: "üìñ",
        price: 500,
        effect: (member) => {
            if (!member.burnout) {
                const growth = Math.floor(5 * member.growthRate);
                member.eng = Math.min(200, member.eng + growth);
            }
            member.stress = Math.max(0, member.stress - 10);
            return `${member.name}„ÅÆ„ÇÑ„ÇãÊ∞ó„Åå„Ç¢„ÉÉ„Éó„Åó„Åæ„Åó„ÅüÔºÅ`;
        }
    },
    massage_ticket: {
        id: "massage_ticket",
        name: "„Éû„ÉÉ„Çµ„Éº„Ç∏Âà∏",
        desc: "„Çπ„Éà„É¨„Çπ„Çí50Ê∏õÂ∞ë",
        icon: "üíÜ",
        price: 800,
        effect: (member) => {
            member.stress = Math.max(0, member.stress - 50);
            return `${member.name}„ÅåÂÆåÂÖ®„Å´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åó„Åæ„Åó„ÅüÔºÅ`;
        }
    },
    special_textbook: {
        id: "special_textbook",
        name: "ÁâπÂà•ÊïôÊùê",
        desc: "Ëã±Ë™ûÂäõ+15Ôºà„Çπ„Éà„É¨„ÇπÂ§âÂåñ„Å™„ÅóÔºâ",
        icon: "üìö",
        price: 1000,
        effect: (member) => {
            if (!member.burnout) {
                const growth = Math.floor(15 * member.growthRate);
                member.eng = Math.min(200, member.eng + growth);
                return `${member.name}„ÅÆËã±Ë™ûÂäõ„Åå${growth}‰∏äÊòá„Åó„Åæ„Åó„ÅüÔºÅ`;
            }
            return `${member.name}„ÅØÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Å™„ÅÆ„ÅßÂäπÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì...`;
        }
    },
    recovery_medicine: {
        id: "recovery_medicine",
        name: "ÁâπÂäπËñ¨",
        desc: "ÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„ÇíÂõûÂæ©",
        icon: "üíä",
        price: 4500,
        effect: (member) => {
            if (member.burnout) {
                member.burnout = false;
                member.stress = 50;
                return `${member.name}„ÅåÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Åã„ÇâÂõûÂæ©„Åó„Åæ„Åó„ÅüÔºÅ`;
            }
            return `${member.name}„ÅØÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Åß„ÅØ„ÅÇ„Çä„Åæ„Åõ„Çì`;
        }
    },
    lucky_charm: {
        id: "lucky_charm",
        name: "„ÅäÂÆà„Çä",
        desc: "„Çπ„Éà„É¨„Çπ-20„ÄÅ‰ø°È†ºÂ∫¶+5",
        icon: "üéê",
        price: 650,
        effect: (member) => {
            member.stress = Math.max(0, member.stress - 20);
            state.trust += 5;
            return `${member.name}„ÅÆÂøÉ„ÅåËêΩ„Å°ÁùÄ„Åç„Åæ„Åó„ÅüÔºà‰ø°È†ºÂ∫¶+5Ôºâ`;
        }
    },
    protein_shake: {
        id: "protein_shake",
        name: "„Éó„É≠„ÉÜ„Ç§„É≥",
        desc: "Ëã±Ë™ûÂäõ+8„ÄÅ„Çπ„Éà„É¨„Çπ-5",
        icon: "ü•§",
        price: 700,
        effect: (member) => {
            if (!member.burnout) {
                const growth = Math.floor(8 * member.growthRate);
                member.eng = Math.min(200, member.eng + growth);
                member.stress = Math.max(0, member.stress - 5);
                return `${member.name}„ÅåÂøÉË∫´„Å®„ÇÇ„Å´Âº∑Âåñ„Åï„Çå„Åæ„Åó„ÅüÔºÅ`;
            }
            member.stress = Math.max(0, member.stress - 5);
            return `${member.name}„ÅØÁáÉ„ÅàÂ∞Ω„ÅçÁóáÂÄôÁæ§„Åß„Åô„Åå„ÄÅÂ∞ë„ÅóÂÖÉÊ∞ó„Å´„Å™„Çä„Åæ„Åó„Åü`;
        }
    }
};

// „Ç§„É≥„Éô„É≥„Éà„É™ÔºàÊâÄÊåÅ„Ç¢„Ç§„ÉÜ„É†ÔºâÂàùÊúüÂåñ
if (!state.inventory) {
    state.inventory = {};
}

// „Ç∑„Éß„ÉÉ„Éó„É¢„Éº„ÉÄ„É´Ë°®Á§∫
function showShopModal() {
    const modal = document.createElement('div');
    modal.className = 'modal shop-modal';
    modal.innerHTML = `
        <div class="shop-modal-content">
            <div class="shop-modal-header">
                <div class="shop-modal-title">üõçÔ∏è „Ç∑„Éß„ÉÉ„Éó</div>
                <div class="shop-budget-display">üí∞ ¬•${state.budget}</div>
            </div>
            <p style="color: #666; margin-bottom: 20px;">„Ç¢„Ç§„ÉÜ„É†„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶Ë≥ºÂÖ•„Åß„Åç„Åæ„Åô</p>
            <div class="shop-items-grid" id="shop-items-grid"></div>
            <button onclick="this.closest('.modal').remove()" class="btn-next" style="margin-top: 20px; width: 100%;">Èñâ„Åò„Çã</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    renderShopItems();
}

// „Ç∑„Éß„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†‰∏ÄË¶ß„ÇíË°®Á§∫
function renderShopItems() {
    const grid = document.getElementById('shop-items-grid');
    if (!grid) return;
    
    grid.innerHTML = '';
    
    Object.values(shopItems).forEach(item => {
        const canAfford = state.budget >= item.price;
        const itemCard = document.createElement('div');
        itemCard.className = `shop-item ${canAfford ? 'affordable' : 'expensive'}`;
        itemCard.innerHTML = `
            <div class="shop-item-icon">${item.icon}</div>
            <div class="shop-item-name">${item.name}</div>
            <div class="shop-item-desc">${item.desc}</div>
            <div class="shop-item-price">¬•${item.price}</div>
        `;
        
        if (canAfford) {
            itemCard.onclick = () => buyItem(item.id, itemCard);
        }
        
        grid.appendChild(itemCard);
    });
}

// „Ç¢„Ç§„ÉÜ„É†Ë≥ºÂÖ•
function buyItem(itemId, cardElement) {
    const item = shopItems[itemId];
    if (state.budget < item.price) {
        showNotification("ÈÉ®Ë≤ª„ÅåË∂≥„Çä„Åæ„Åõ„ÇìÔºÅ", "error");
        return;
    }
    
    // Ë≥ºÂÖ•„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
    cardElement.classList.add('purchasing');
    
    setTimeout(() => {
        state.budget -= item.price;
        
        // „Ç§„É≥„Éô„É≥„Éà„É™„Å´ËøΩÂä†
        if (!state.inventory[itemId]) {
            state.inventory[itemId] = 0;
        }
        state.inventory[itemId]++;
        
        showNotification(`${item.name}„ÇíË≥ºÂÖ•„Åó„Åæ„Åó„ÅüÔºÅ`, "success");
        
        // „Ç∑„Éß„ÉÉ„ÉóÂÜÖ„ÅÆ‰∫àÁÆóË°®Á§∫„ÇíÊõ¥Êñ∞
        const budgetDisplay = document.querySelector('.shop-budget-display');
        if (budgetDisplay) {
            budgetDisplay.textContent = `üí∞ ¬•${state.budget}`;
        }
        
        // „Ç∑„Éß„ÉÉ„Éó„Ç¢„Ç§„ÉÜ„É†„ÇíÂÜçÊèèÁîª
        renderShopItems();
        
        // UIÊõ¥Êñ∞
        updateUI();
        renderInventory();
        
        cardElement.classList.remove('purchasing');
    }, 300);
}

// „Ç§„É≥„Éô„É≥„Éà„É™Ë°®Á§∫
function renderInventory() {
    const inventoryList = document.getElementById('inventory-list');
    const inventoryCount = document.getElementById('inventory-count');
    
    if (!inventoryList) return;
    
    inventoryList.innerHTML = '';
    
    const totalItems = Object.values(state.inventory).reduce((sum, count) => sum + count, 0);
    
    if (inventoryCount) {
        inventoryCount.textContent = `(${totalItems}ÂÄã)`;
    }
    
    if (totalItems === 0) {
        inventoryList.innerHTML = '<div style="color: #999; font-style: italic;">„Ç¢„Ç§„ÉÜ„É†„ÇíÊåÅ„Å£„Å¶„ÅÑ„Åæ„Åõ„Çì</div>';
        return;
    }
    
    Object.entries(state.inventory).forEach(([itemId, count]) => {
        if (count <= 0) return;
        
        const item = shopItems[itemId];
        const itemDiv = document.createElement('div');
        itemDiv.className = 'inventory-item';
        itemDiv.innerHTML = `
            <div class="inventory-item-icon">${item.icon}</div>
            <div class="inventory-item-info">
                <div class="inventory-item-name">${item.name}</div>
                <div class="inventory-item-desc">${item.desc}</div>
            </div>
            <div class="inventory-item-count">${count}</div>
        `;
        itemDiv.onclick = () => showUseItemModal(itemId);
        inventoryList.appendChild(itemDiv);
    });
}

// „Ç¢„Ç§„ÉÜ„É†‰ΩøÁî®„É¢„Éº„ÉÄ„É´
function showUseItemModal(itemId) {
    const item = shopItems[itemId];
    
    const modal = document.createElement('div');
    modal.className = 'modal use-item-modal';
    modal.innerHTML = `
        <div class="modal-content">
            <h2 style="margin-bottom: 15px;">${item.icon} ${item.name}„Çí‰ΩøÁî®</h2>
            <div style="background: #f5f5f5; padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                <div style="font-weight: bold; color: #667eea; margin-bottom: 5px;">ÂäπÊûú</div>
                <div style="color: #666;">${item.desc}</div>
            </div>
            <p style="margin-bottom: 15px; font-weight: bold; color: #333;">‰ΩøÁî®„Åô„ÇãÈÉ®Âì°„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
            <div id="member-select-list" style="max-height: 400px; overflow-y: auto;"></div>
            <button onclick="this.closest('.modal').remove()" class="btn-choice" style="margin-top: 20px; width: 100%;">„Ç≠„É£„É≥„Çª„É´</button>
        </div>
    `;
    document.body.appendChild(modal);
    
    const memberList = document.getElementById('member-select-list');
    
    state.members.forEach(m => {
        const trait = traitData[m.trait];
        const card = document.createElement('div');
        card.className = 'member-select-card';
        card.innerHTML = `
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <div style="font-weight: bold; font-size: 1.1em; margin-bottom: 5px;">${m.name}Ôºà${m.year}Âπ¥Ôºâ</div>
                    <div style="font-size: 0.9em; color: #666; margin-bottom: 8px;">
                        Ëã±Ë™ûÂäõ: ${m.eng} / „Çπ„Éà„É¨„Çπ: ${m.stress}
                    </div>
                    <div style="display: flex; gap: 5px; align-items: center;">
                        <span class="trait-tag ${trait.cssClass}">${m.trait}</span>
                        ${m.burnout ? '<span style="background: #f44336; color: white; padding: 2px 8px; border-radius: 8px; font-size: 0.8em;">üî• ÁáÉ„ÅàÂ∞Ω„Åç</span>' : ''}
                    </div>
                </div>
                <div style="font-size: 2.5em; opacity: 0.7;">${item.icon}</div>
            </div>
        `;
        card.onclick = () => useItemOnMember(itemId, m, modal);
        memberList.appendChild(card);
    });
}

// „Ç¢„Ç§„ÉÜ„É†„ÇíÈÉ®Âì°„Å´‰ΩøÁî®
function useItemOnMember(itemId, member, modal) {
    const item = shopItems[itemId];
    
    // „Ç¢„Ç§„ÉÜ„É†„ÅÆÂäπÊûú„ÇíÈÅ©Áî®
    const resultMessage = item.effect(member);
    
    // „Ç§„É≥„Éô„É≥„Éà„É™„Åã„ÇâÂâäÈô§
    state.inventory[itemId]--;
    if (state.inventory[itemId] <= 0) {
        delete state.inventory[itemId];
    }
    
    // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
    document.body.removeChild(modal);
    
    // ÁµêÊûúË°®Á§∫
    showNotification(resultMessage, "success");
    
    // UIÊõ¥Êñ∞
    updateUI();
    renderInventory();
    checkAchievements();
}

// ============================================
// Êó¢Â≠òÈñ¢Êï∞„Å∏„ÅÆÁµ±Âêà
// ============================================

// updateUIÈñ¢Êï∞„Å´ËøΩÂä†
const originalUpdateUI3 = window.updateUI;
window.updateUI = function() {
    if (originalUpdateUI3) originalUpdateUI3();
    renderInventory();
    checkAchievements();
};

// initGameÈñ¢Êï∞„Å´ËøΩÂä†
const originalInitGame2 = window.initGame;
window.initGame = function() {
    if (!state.inventory) {
        state.inventory = {};
    }
    if (originalInitGame2) originalInitGame2();
    renderInventory();
};

// „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´„Ç§„É≥„Éô„É≥„Éà„É™„ÇíÂàùÊúüÂåñ
window.addEventListener('DOMContentLoaded', () => {
    if (!state.inventory) {
        state.inventory = {};
    }
});
    
    
</script>
</body>
</html>
